<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>建议器 | Elasticsearch 中文文档</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/favicon.ico">
    <script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8380975615223941" crossorigin="anonymous"></script>
    <meta name="description" content="Elasticsearch 中文文档，基于 v7.11 官方文档开始翻译">
    <meta name="keywords" content="Elastic,Elasticsearch,ElasticStack,ELK,Document,docs,文档,中文文档,入门">
    
    <link rel="preload" href="/assets/css/0.styles.87a55001.css" as="style"><link rel="preload" href="/assets/js/app.f54b6f9f.js" as="script"><link rel="preload" href="/assets/js/2.c3078b94.js" as="script"><link rel="preload" href="/assets/js/108.684c837a.js" as="script"><link rel="prefetch" href="/assets/js/10.0268c297.js"><link rel="prefetch" href="/assets/js/100.9de07136.js"><link rel="prefetch" href="/assets/js/101.6b8f1eb5.js"><link rel="prefetch" href="/assets/js/102.40ae2247.js"><link rel="prefetch" href="/assets/js/103.15f45561.js"><link rel="prefetch" href="/assets/js/104.08813b13.js"><link rel="prefetch" href="/assets/js/105.072ab95d.js"><link rel="prefetch" href="/assets/js/106.5c4e70b8.js"><link rel="prefetch" href="/assets/js/107.7033c270.js"><link rel="prefetch" href="/assets/js/109.c45629d4.js"><link rel="prefetch" href="/assets/js/11.2421a902.js"><link rel="prefetch" href="/assets/js/110.ecbd4962.js"><link rel="prefetch" href="/assets/js/111.60ec4b97.js"><link rel="prefetch" href="/assets/js/112.6d00c06a.js"><link rel="prefetch" href="/assets/js/113.cd021933.js"><link rel="prefetch" href="/assets/js/114.300acbcd.js"><link rel="prefetch" href="/assets/js/115.b42b7a52.js"><link rel="prefetch" href="/assets/js/116.5e3de158.js"><link rel="prefetch" href="/assets/js/117.b497aeca.js"><link rel="prefetch" href="/assets/js/118.c40d791b.js"><link rel="prefetch" href="/assets/js/119.15083082.js"><link rel="prefetch" href="/assets/js/12.7db7d3e7.js"><link rel="prefetch" href="/assets/js/120.93860c72.js"><link rel="prefetch" href="/assets/js/121.3ad921c9.js"><link rel="prefetch" href="/assets/js/122.0aec2afd.js"><link rel="prefetch" href="/assets/js/123.3b3820d1.js"><link rel="prefetch" href="/assets/js/124.370c6e81.js"><link rel="prefetch" href="/assets/js/125.403d0704.js"><link rel="prefetch" href="/assets/js/126.18292c99.js"><link rel="prefetch" href="/assets/js/127.5e25a5ff.js"><link rel="prefetch" href="/assets/js/128.b4926d7e.js"><link rel="prefetch" href="/assets/js/129.5cfc0795.js"><link rel="prefetch" href="/assets/js/13.f7bd7d98.js"><link rel="prefetch" href="/assets/js/130.daed387b.js"><link rel="prefetch" href="/assets/js/131.11298c7e.js"><link rel="prefetch" href="/assets/js/132.3fa1e674.js"><link rel="prefetch" href="/assets/js/133.bf6623b7.js"><link rel="prefetch" href="/assets/js/134.5a756904.js"><link rel="prefetch" href="/assets/js/135.4ed99321.js"><link rel="prefetch" href="/assets/js/136.f474120f.js"><link rel="prefetch" href="/assets/js/137.0e230c25.js"><link rel="prefetch" href="/assets/js/14.2bcba9b1.js"><link rel="prefetch" href="/assets/js/15.9712105c.js"><link rel="prefetch" href="/assets/js/16.8ab752a5.js"><link rel="prefetch" href="/assets/js/17.6de20a2a.js"><link rel="prefetch" href="/assets/js/18.e504e957.js"><link rel="prefetch" href="/assets/js/19.208be713.js"><link rel="prefetch" href="/assets/js/20.2e9bdc63.js"><link rel="prefetch" href="/assets/js/21.d4a49a8b.js"><link rel="prefetch" href="/assets/js/22.0446ed10.js"><link rel="prefetch" href="/assets/js/23.a4fb764c.js"><link rel="prefetch" href="/assets/js/24.6c75ce3f.js"><link rel="prefetch" href="/assets/js/25.d670158f.js"><link rel="prefetch" href="/assets/js/26.03f10ce6.js"><link rel="prefetch" href="/assets/js/27.a37dedd5.js"><link rel="prefetch" href="/assets/js/28.27fa4b32.js"><link rel="prefetch" href="/assets/js/29.5ce688fe.js"><link rel="prefetch" href="/assets/js/3.f849e4bc.js"><link rel="prefetch" href="/assets/js/30.a951767b.js"><link rel="prefetch" href="/assets/js/31.349c7c0f.js"><link rel="prefetch" href="/assets/js/32.1560337b.js"><link rel="prefetch" href="/assets/js/33.47920c4a.js"><link rel="prefetch" href="/assets/js/34.019af1d9.js"><link rel="prefetch" href="/assets/js/35.4f48f0bf.js"><link rel="prefetch" href="/assets/js/36.dcadddfc.js"><link rel="prefetch" href="/assets/js/37.6168f6a2.js"><link rel="prefetch" href="/assets/js/38.b9973ed9.js"><link rel="prefetch" href="/assets/js/39.f676d7e9.js"><link rel="prefetch" href="/assets/js/4.b8adb022.js"><link rel="prefetch" href="/assets/js/40.6f283444.js"><link rel="prefetch" href="/assets/js/41.1bee86e3.js"><link rel="prefetch" href="/assets/js/42.ad482e2b.js"><link rel="prefetch" href="/assets/js/43.8b46d9cb.js"><link rel="prefetch" href="/assets/js/44.a3fe224e.js"><link rel="prefetch" href="/assets/js/45.b254769d.js"><link rel="prefetch" href="/assets/js/46.47ad3d4b.js"><link rel="prefetch" href="/assets/js/47.61da0555.js"><link rel="prefetch" href="/assets/js/48.23054156.js"><link rel="prefetch" href="/assets/js/49.1ccb0d07.js"><link rel="prefetch" href="/assets/js/5.ff5c5ea8.js"><link rel="prefetch" href="/assets/js/50.d9ebcadb.js"><link rel="prefetch" href="/assets/js/51.ed72c753.js"><link rel="prefetch" href="/assets/js/52.30faa61c.js"><link rel="prefetch" href="/assets/js/53.93256120.js"><link rel="prefetch" href="/assets/js/54.74850984.js"><link rel="prefetch" href="/assets/js/55.dd83a54b.js"><link rel="prefetch" href="/assets/js/56.5b6d142e.js"><link rel="prefetch" href="/assets/js/57.e57da23c.js"><link rel="prefetch" href="/assets/js/58.be41490d.js"><link rel="prefetch" href="/assets/js/59.080acdfe.js"><link rel="prefetch" href="/assets/js/6.ed3f2a05.js"><link rel="prefetch" href="/assets/js/60.e691b08c.js"><link rel="prefetch" href="/assets/js/61.7f9e8bc5.js"><link rel="prefetch" href="/assets/js/62.ee63803f.js"><link rel="prefetch" href="/assets/js/63.aae89af4.js"><link rel="prefetch" href="/assets/js/64.d247c52a.js"><link rel="prefetch" href="/assets/js/65.2ee8bba7.js"><link rel="prefetch" href="/assets/js/66.272b1339.js"><link rel="prefetch" href="/assets/js/67.066e8bdc.js"><link rel="prefetch" href="/assets/js/68.336efe2d.js"><link rel="prefetch" href="/assets/js/69.989b1eea.js"><link rel="prefetch" href="/assets/js/7.4a9e0db8.js"><link rel="prefetch" href="/assets/js/70.34beee4d.js"><link rel="prefetch" href="/assets/js/71.a3d541e7.js"><link rel="prefetch" href="/assets/js/72.b03d17a3.js"><link rel="prefetch" href="/assets/js/73.aa6f0650.js"><link rel="prefetch" href="/assets/js/74.68a87ef1.js"><link rel="prefetch" href="/assets/js/75.0e6785de.js"><link rel="prefetch" href="/assets/js/76.de95365c.js"><link rel="prefetch" href="/assets/js/77.14e67824.js"><link rel="prefetch" href="/assets/js/78.f79a8a2b.js"><link rel="prefetch" href="/assets/js/79.b2471459.js"><link rel="prefetch" href="/assets/js/8.13a80b3e.js"><link rel="prefetch" href="/assets/js/80.5112b96d.js"><link rel="prefetch" href="/assets/js/81.6b29f29e.js"><link rel="prefetch" href="/assets/js/82.20896295.js"><link rel="prefetch" href="/assets/js/83.13f55595.js"><link rel="prefetch" href="/assets/js/84.6c82c67a.js"><link rel="prefetch" href="/assets/js/85.4e171f21.js"><link rel="prefetch" href="/assets/js/86.de1f7aca.js"><link rel="prefetch" href="/assets/js/87.dc55c361.js"><link rel="prefetch" href="/assets/js/88.483af93d.js"><link rel="prefetch" href="/assets/js/89.1f89586e.js"><link rel="prefetch" href="/assets/js/9.0b2c6418.js"><link rel="prefetch" href="/assets/js/90.f2aa4c43.js"><link rel="prefetch" href="/assets/js/91.4314d8d8.js"><link rel="prefetch" href="/assets/js/92.494eccaf.js"><link rel="prefetch" href="/assets/js/93.0def2ee8.js"><link rel="prefetch" href="/assets/js/94.07681219.js"><link rel="prefetch" href="/assets/js/95.0a36c10d.js"><link rel="prefetch" href="/assets/js/96.f1f4aafe.js"><link rel="prefetch" href="/assets/js/97.c65f9c4f.js"><link rel="prefetch" href="/assets/js/98.dee248d7.js"><link rel="prefetch" href="/assets/js/99.018666f7.js">
    <link rel="stylesheet" href="/assets/css/0.styles.87a55001.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/favicon.ico" alt="Elasticsearch 中文文档" class="logo"> <span class="site-name can-hide">Elasticsearch 中文文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://www.bookhub.tech" target="_blank" rel="noopener noreferrer" class="nav-link external">
  BookHub 首页
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://docs.bookhub.tech" target="_blank" rel="noopener noreferrer" class="nav-link external">
  中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://pdf.bookhub.tech" target="_blank" rel="noopener noreferrer" class="nav-link external">
  计算机书库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/dev2007/elasticsearch-doc" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://www.bookhub.tech" target="_blank" rel="noopener noreferrer" class="nav-link external">
  BookHub 首页
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://docs.bookhub.tech" target="_blank" rel="noopener noreferrer" class="nav-link external">
  中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://pdf.bookhub.tech" target="_blank" rel="noopener noreferrer" class="nav-link external">
  计算机书库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/dev2007/elasticsearch-doc" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">Elasticsearch 翻译说明</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/#感谢与支持" class="sidebar-link">感谢与支持</a></li></ul></li><li><section class="sidebar-group collapsable depth-0"><a href="/intro" class="sidebar-heading clickable"><span>什么是 Elasticsearch？</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/getting_started" class="sidebar-heading clickable"><span>Elasticsearch 入门</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/set_up_elasticsearch" class="sidebar-heading clickable"><span>设置 Elasticsearch</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/index_modules" class="sidebar-heading clickable"><span>索引模块</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/rest_apis" class="sidebar-heading clickable router-link-active open"><span>REST API</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/rest_apis/api_convention" class="sidebar-heading clickable"><span>API 约定</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/rest_apis/autoscaling_apis" class="sidebar-heading clickable"><span>自动伸缩 API</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/rest_apis/document_apis" class="sidebar-heading clickable"><span>文档 API</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/rest_apis/index_apis" class="sidebar-heading clickable"><span>索引 API</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/rest_apis/search_apis" class="sidebar-heading clickable router-link-active open"><span>搜索相关 API</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/rest_apis/search_apis/search.html" class="sidebar-link">搜索</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/search.html#请求" class="sidebar-link">请求</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/search.html#前置条件" class="sidebar-link">前置条件</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/search.html#描述" class="sidebar-link">描述</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/search.html#路径参数" class="sidebar-link">路径参数</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/search.html#查询参数" class="sidebar-link">查询参数</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/search.html#请求体" class="sidebar-link">请求体</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/search.html#响应体" class="sidebar-link">响应体</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/search.html#示例" class="sidebar-link">示例</a></li></ul></li><li><a href="/rest_apis/search_apis/multi_search.html" class="sidebar-link">多重搜索</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/multi_search.html#请求" class="sidebar-link">请求</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/multi_search.html#前置条件" class="sidebar-link">前置条件</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/multi_search.html#描述" class="sidebar-link">描述</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/multi_search.html#路径参数" class="sidebar-link">路径参数</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/multi_search.html#查询参数" class="sidebar-link">查询参数</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/multi_search.html#请求体" class="sidebar-link">请求体</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/multi_search.html#响应体" class="sidebar-link">响应体</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/multi_search.html#示例" class="sidebar-link">示例</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/multi_search.html#安全" class="sidebar-link">安全</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/multi_search.html#部分响应" class="sidebar-link">部分响应</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/multi_search.html#取消搜索" class="sidebar-link">取消搜索</a></li></ul></li><li><a href="/rest_apis/search_apis/async_search.html" class="sidebar-link">异步搜索</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/async_search.html#提交异步搜索-api" class="sidebar-link">提交异步搜索 API</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/async_search.html#获取异步搜索" class="sidebar-link">获取异步搜索</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/async_search.html#获取异步搜索状态" class="sidebar-link">获取异步搜索状态</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/async_search.html#删除异步搜索" class="sidebar-link">删除异步搜索</a></li></ul></li><li><a href="/rest_apis/search_apis/point_in_time.html" class="sidebar-link">时间点</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/point_in_time.html#前置条件" class="sidebar-link">前置条件</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/point_in_time.html#示例" class="sidebar-link">示例</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/point_in_time.html#保持时间点活动" class="sidebar-link">保持时间点活动</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/point_in_time.html#关闭时间点-api" class="sidebar-link">关闭时间点 API</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/point_in_time.html#搜索切片" class="sidebar-link">搜索切片</a></li></ul></li><li><a href="/rest_apis/search_apis/knn_search.html" class="sidebar-link">kNN 搜索</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/knn_search.html#请求" class="sidebar-link">请求</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/knn_search.html#前置条件" class="sidebar-link">前置条件</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/knn_search.html#描述" class="sidebar-link">描述</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/knn_search.html#路径参数" class="sidebar-link">路径参数</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/knn_search.html#查询参数" class="sidebar-link">查询参数</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/knn_search.html#请求体" class="sidebar-link">请求体</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/knn_search.html#响应体" class="sidebar-link">响应体</a></li></ul></li><li><a href="/rest_apis/search_apis/suggesters.html" aria-current="page" class="active sidebar-link">建议器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/suggesters.html#请求" class="sidebar-link">请求</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/suggesters.html#示例" class="sidebar-link">示例</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/suggesters.html#全局建议文本" class="sidebar-link">全局建议文本</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/suggesters.html#词语建议器" class="sidebar-link">词语建议器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/suggesters.html#常见建议选项" class="sidebar-link">常见建议选项</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/suggesters.html#其他词语建议选项" class="sidebar-link">其他词语建议选项</a></li></ul></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/suggesters.html#短语建议器" class="sidebar-link">短语建议器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/suggesters.html#api-示例" class="sidebar-link">API 示例</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/suggesters.html#基本短语建议-api-参数" class="sidebar-link">基本短语建议 API 参数</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/suggesters.html#平滑模型" class="sidebar-link">平滑模型</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/suggesters.html#候选生成器" class="sidebar-link">候选生成器</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/suggesters.html#直接生成器" class="sidebar-link">直接生成器</a></li></ul></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/suggesters.html#完成建议器" class="sidebar-link">完成建议器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/suggesters.html#映射" class="sidebar-link">映射</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/suggesters.html#索引" class="sidebar-link">索引</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/suggesters.html#查询" class="sidebar-link">查询</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/suggesters.html#跳过重复的建议" class="sidebar-link">跳过重复的建议</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/suggesters.html#模糊查询" class="sidebar-link">模糊查询</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/suggesters.html#正则查询" class="sidebar-link">正则查询</a></li></ul></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/suggesters.html#上下文建议器" class="sidebar-link">上下文建议器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/suggesters.html#类别上下文" class="sidebar-link">类别上下文</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/suggesters.html#类别查询" class="sidebar-link">类别查询</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/suggesters.html#地理位置上下文" class="sidebar-link">地理位置上下文</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/suggesters.html#地理位置查询" class="sidebar-link">地理位置查询</a></li></ul></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/suggesters.html#返回建议器类型" class="sidebar-link">返回建议器类型</a></li></ul></li><li><a href="/rest_apis/search_apis/terms_enum.html" class="sidebar-link">词语枚举</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/terms_enum.html#请求" class="sidebar-link">请求</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/terms_enum.html#描述" class="sidebar-link">描述</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/terms_enum.html#路径参数" class="sidebar-link">路径参数</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/terms_enum.html#请求体" class="sidebar-link">请求体</a></li></ul></li><li><a href="/rest_apis/search_apis/scroll.html" class="sidebar-link">滚动</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/scroll.html#请求" class="sidebar-link">请求</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/scroll.html#前置条件" class="sidebar-link">前置条件</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/scroll.html#描述" class="sidebar-link">描述</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/scroll.html#路径参数" class="sidebar-link">路径参数</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/scroll.html#查询参数" class="sidebar-link">查询参数</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/scroll.html#请求体" class="sidebar-link">请求体</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/scroll.html#响应体" class="sidebar-link">响应体</a></li></ul></li><li><a href="/rest_apis/search_apis/clear_scroll.html" class="sidebar-link">清除滚动</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/clear_scroll.html#请求" class="sidebar-link">请求</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/clear_scroll.html#路径参数" class="sidebar-link">路径参数</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/clear_scroll.html#查询参数" class="sidebar-link">查询参数</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/clear_scroll.html#请求体" class="sidebar-link">请求体</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/clear_scroll.html#响应体" class="sidebar-link">响应体</a></li></ul></li><li><a href="/rest_apis/search_apis/explain.html" class="sidebar-link">解释</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/explain.html#请求" class="sidebar-link">请求</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/explain.html#前置条件" class="sidebar-link">前置条件</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/explain.html#描述" class="sidebar-link">描述</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/explain.html#路径参数" class="sidebar-link">路径参数</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/explain.html#查询参数" class="sidebar-link">查询参数</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/explain.html#请求体" class="sidebar-link">请求体</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/explain.html#示例" class="sidebar-link">示例</a></li></ul></li></ul></li><li><a href="/rest_apis/search_apis/field_capabilities.html" class="sidebar-link">字段能力</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/field_capabilities.html#请求" class="sidebar-link">请求</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/field_capabilities.html#前置条件" class="sidebar-link">前置条件</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/field_capabilities.html#描述" class="sidebar-link">描述</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/field_capabilities.html#路径参数" class="sidebar-link">路径参数</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/field_capabilities.html#查询参数" class="sidebar-link">查询参数</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/field_capabilities.html#请求体" class="sidebar-link">请求体</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/field_capabilities.html#响应体" class="sidebar-link">响应体</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/field_capabilities.html#示例" class="sidebar-link">示例</a></li></ul></li><li><a href="/rest_apis/search_apis/profile.html" class="sidebar-link">分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/profile.html#描述" class="sidebar-link">描述</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/profile.html#示例" class="sidebar-link">示例</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/profile.html#分析查询" class="sidebar-link">分析查询</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/profile.html#query-部分" class="sidebar-link">query 部分</a></li></ul></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/profile.html#细化计时" class="sidebar-link">细化计时</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/profile.html#collectors-部分" class="sidebar-link">collectors 部分</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/profile.html#rewrite-部分" class="sidebar-link">rewrite 部分</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/profile.html#一个更复杂的例子" class="sidebar-link">一个更复杂的例子</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/profile.html#了解-multitermquery-的输出" class="sidebar-link">了解 MultiTermQuery 的输出</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/profile.html#分析聚合" class="sidebar-link">分析聚合</a></li></ul></li></ul></li><li><a href="/rest_apis/search_apis/ranking_evaluation.html" class="sidebar-link">排序评估</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/ranking_evaluation.html#请求" class="sidebar-link">请求</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/ranking_evaluation.html#前置条件" class="sidebar-link">前置条件</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/ranking_evaluation.html#描述" class="sidebar-link">描述</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/ranking_evaluation.html#路径参数" class="sidebar-link">路径参数</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/ranking_evaluation.html#查询参数" class="sidebar-link">查询参数</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/ranking_evaluation.html#示例" class="sidebar-link">示例</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/ranking_evaluation.html#基于模板的排名评估" class="sidebar-link">基于模板的排名评估</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/ranking_evaluation.html#可用的评估指标" class="sidebar-link">可用的评估指标</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/ranking_evaluation.html#响应格式" class="sidebar-link">响应格式</a></li></ul></li></ul></li><li><a href="/rest_apis/search_apis/search_shards.html" class="sidebar-link">搜索分片</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/search_shards.html#请求" class="sidebar-link">请求</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/search_shards.html#前置条件" class="sidebar-link">前置条件</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/search_shards.html#描述" class="sidebar-link">描述</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/search_shards.html#路径参数" class="sidebar-link">路径参数</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/search_shards.html#查询参数" class="sidebar-link">查询参数</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/search_shards.html#示例" class="sidebar-link">示例</a></li></ul></li><li><a href="/rest_apis/search_apis/validate.html" class="sidebar-link">验证</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/validate.html#请求" class="sidebar-link">请求</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/validate.html#前置条件" class="sidebar-link">前置条件</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/validate.html#描述" class="sidebar-link">描述</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/validate.html#路径参数" class="sidebar-link">路径参数</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/validate.html#查询参数" class="sidebar-link">查询参数</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/validate.html#示例" class="sidebar-link">示例</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/validate.html#explain-参数" class="sidebar-link">explain 参数</a></li></ul></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/validate.html#rewrite-参数" class="sidebar-link">rewrite 参数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/validate.html#rewrite-和-all-shards-参数" class="sidebar-link">rewrite 和 all_shards 参数</a></li></ul></li></ul></li><li><a href="/rest_apis/search_apis/search_template.html" class="sidebar-link">搜索模板</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/search_template.html#请求" class="sidebar-link">请求</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/search_template.html#前置条件" class="sidebar-link">前置条件</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/search_template.html#路径参数" class="sidebar-link">路径参数</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/search_template.html#查询参数" class="sidebar-link">查询参数</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/search_template.html#请求体" class="sidebar-link">请求体</a></li></ul></li><li><a href="/rest_apis/search_apis/multi_search_template.html" class="sidebar-link">多搜索模板</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/multi_search_template.html#请求" class="sidebar-link">请求</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/multi_search_template.html#前置条件" class="sidebar-link">前置条件</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/multi_search_template.html#路径参数" class="sidebar-link">路径参数</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/multi_search_template.html#查询参数" class="sidebar-link">查询参数</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/multi_search_template.html#请求体" class="sidebar-link">请求体</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/multi_search_template.html#响应码" class="sidebar-link">响应码</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/multi_search_template.html#响应体" class="sidebar-link">响应体</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/multi_search_template.html#curl-请求" class="sidebar-link">curl 请求</a></li></ul></li><li><a href="/rest_apis/search_apis/render_search_template.html" class="sidebar-link">渲染搜索模板</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/render_search_template.html#请求" class="sidebar-link">请求</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/render_search_template.html#前置条件" class="sidebar-link">前置条件</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/render_search_template.html#路径参数" class="sidebar-link">路径参数</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/render_search_template.html#请求体" class="sidebar-link">请求体</a></li></ul></li><li><a href="/rest_apis/search_apis/vector_tile_search.html" class="sidebar-link">矢量块搜索</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/vector_tile_search.html#请求" class="sidebar-link">请求</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/vector_tile_search.html#前置条件" class="sidebar-link">前置条件</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/vector_tile_search.html#路径参数" class="sidebar-link">路径参数</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/vector_tile_search.html#描述" class="sidebar-link">描述</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/vector_tile_search.html#查询参数" class="sidebar-link">查询参数</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/vector_tile_search.html#请求体" class="sidebar-link">请求体</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/vector_tile_search.html#响应" class="sidebar-link">响应</a></li><li class="sidebar-sub-header"><a href="/rest_apis/search_apis/vector_tile_search.html#示例" class="sidebar-link">示例</a></li></ul></li></ul></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="建议器"><a href="#建议器" class="header-anchor">#</a> 建议器</h1> <p>通过使用建议器，可基于提供的文本建议类似的词语。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>POST my-index-000001/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;query&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;message&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;tring out Elasticsearch&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>,
  <span class="token string">&quot;suggest&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;my-suggestion&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;text&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;tring out Elasticsearch&quot;</span>,
      <span class="token string">&quot;term&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;field&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;message&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="请求"><a href="#请求" class="header-anchor">#</a> 请求</h2> <p>建议功能通过使用建议器，基于提供的文本建议类似的词语。建议请求部分与 <code>_search</code> 请求中的查询部分一起定义。如果省略了查询部分，则只返回建议。</p> <h2 id="示例"><a href="#示例" class="header-anchor">#</a> 示例</h2> <p>每个请求可以指定多个建议。每个建议都有一个任意的名称。在下面的例子中，需要两条建议。<code>my-suggest-1</code> 和 <code>my-suggest-2</code> 建议都使用 <code>term</code> 建议器，但不同于 <code>text</code>。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>POST _search
<span class="token punctuation">{</span>
  <span class="token string">&quot;suggest&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;my-suggest-1&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;text&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;tring out Elasticsearch&quot;</span>,
      <span class="token string">&quot;term&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;field&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;message&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;my-suggest-2&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;text&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;kmichy&quot;</span>,
      <span class="token string">&quot;term&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;field&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;user.id&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>下面的建议响应示例包括 <code>my-suggest-1</code> 和 <code>my-suggest-2</code> 的建议响应。每个建议部分都包含条目。每个条目实际上是建议文本中的一个标记，包含建议条目文本、建议文本中的原始起始偏移量和长度，如果找到，还包含任意数量的选项。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;_shards&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">..</span>.
  <span class="token string">&quot;hits&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">..</span>.
  <span class="token string">&quot;took&quot;</span><span class="token builtin class-name">:</span> <span class="token number">2</span>,
  <span class="token string">&quot;timed_out&quot;</span><span class="token builtin class-name">:</span> false,
  <span class="token string">&quot;suggest&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;my-suggest-1&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;text&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;tring&quot;</span>,
      <span class="token string">&quot;offset&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
      <span class="token string">&quot;length&quot;</span><span class="token builtin class-name">:</span> <span class="token number">5</span>,
      <span class="token string">&quot;options&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token punctuation">{</span><span class="token string">&quot;text&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;trying&quot;</span>, <span class="token string">&quot;score&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0.8</span>, <span class="token string">&quot;freq&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>, <span class="token punctuation">{</span>
      <span class="token string">&quot;text&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;out&quot;</span>,
      <span class="token string">&quot;offset&quot;</span><span class="token builtin class-name">:</span> <span class="token number">6</span>,
      <span class="token string">&quot;length&quot;</span><span class="token builtin class-name">:</span> <span class="token number">3</span>,
      <span class="token string">&quot;options&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>, <span class="token punctuation">{</span>
      <span class="token string">&quot;text&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;elasticsearch&quot;</span>,
      <span class="token string">&quot;offset&quot;</span><span class="token builtin class-name">:</span> <span class="token number">10</span>,
      <span class="token string">&quot;length&quot;</span><span class="token builtin class-name">:</span> <span class="token number">13</span>,
      <span class="token string">&quot;options&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span> <span class="token punctuation">]</span>,
    <span class="token string">&quot;my-suggest-2&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">..</span>.
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>每个选项数组都包含一个选项对象，其中包括建议文本、其文档频率以及与建议条目文本相比的分数。分数的意义取决于所用的建议词。术语建议者的分数基于编辑距离。</p> <h2 id="全局建议文本"><a href="#全局建议文本" class="header-anchor">#</a> 全局建议文本</h2> <p>为了避免重复建议文本，可以定义一个全局文本。在下面的示例中，建议文本是全局定义的，适用于 <code>my-suggest-1</code> 和 <code>my-suggest-2</code> 建议。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>POST _search
<span class="token punctuation">{</span>
  <span class="token string">&quot;suggest&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;text&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;tring out Elasticsearch&quot;</span>,
    <span class="token string">&quot;my-suggest-1&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;term&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;field&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;message&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;my-suggest-2&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
       <span class="token string">&quot;term&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;field&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;user&quot;</span>
       <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>上述示例中的建议文本也可以指定为建议特定选项。建议级别上指定的建议文本将覆盖全局级别上的建议文本。</p> <h2 id="词语建议器"><a href="#词语建议器" class="header-anchor">#</a> 词语建议器</h2> <p><code>term</code> 建议器根据编辑距离建议词语。在建议词语之前，先分析所提供的建议文本。建议条款根据分析的建议文本标记提供。<code>term</code> 建议器不考虑作为请求一部分的查询。</p> <h3 id="常见建议选项"><a href="#常见建议选项" class="header-anchor">#</a> 常见建议选项</h3> <table><thead><tr><th></th> <th></th></tr></thead> <tbody><tr><td><code>text</code></td> <td>建议文本。建议文本是一个必需选项，需要在全局范围内或根据建议进行设置。</td></tr> <tr><td><code>field</code></td> <td>获取候选人建议的字段。这是一个必需的选项，需要在全局范围内或根据建议进行设置。</td></tr> <tr><td><code>analyzer</code></td> <td>分析人员用以分析建议文本。默认为“建议”字段的搜索分析器。</td></tr> <tr><td><code>size</code></td> <td>每个建议文本标记返回的最大更正。</td></tr> <tr><td><code>sort</code></td> <td>定义每个建议文本项的建议排序方式。两个可能的值：<code>score</code>：首先按分数排序，然后记录频率，然后是术语本身。<code>frequency</code>：首先按文档频率排序，然后按相似度得分排序，然后按词语本身排序。</td></tr> <tr><td><code>suggest_mode</code></td> <td>建议模式控制包含哪些建议，或控制建议文本的内容、建议应被建议。可以指定三个可能的值：<code>missing</code>：仅为索引中没有的建议文本词语提供建议。这是默认设置。<code>popular</code>：仅建议出现在比原始建议文本词更多文档中的建议。<code>always</code>：根据建议文本中的词语提出任何匹配建议。</td></tr></tbody></table> <h3 id="其他词语建议选项"><a href="#其他词语建议选项" class="header-anchor">#</a> 其他词语建议选项</h3> <table><thead><tr><th></th> <th></th></tr></thead> <tbody><tr><td><code>max_edits</code></td> <td>候选建议可以具有的最大编辑距离可以被视为建议。只能是介于 1 和 2 之间的值。任何其他值都会导致抛出错误的请求错误。默认值为 2。</td></tr> <tr><td><code>prefix_length</code></td> <td>必须匹配的最小前缀字符数，才能作为建议的候选字符。默认值为 1。增加这个数字可以提高拼写检查性能。通常拼写错误不会发生在词语开头。</td></tr> <tr><td><code>min_word_length</code></td> <td>建议文本词语必须包含的最小长度。默认为 4。</td></tr> <tr><td><code>shard_size</code></td> <td>要从每个建议集检索的最大建议数。在收缩（reduce）阶段，根据 <code>size</code> 选项只返回前 N 个建议。默认为 <code>size</code> 选项。为了以性能为代价获得更准确的拼写更正文档频率，将该值设置为大于 <code>size</code> 值会很有用。由于词语是在分片之间划分的，分片级别的文档拼写更正频率可能不精确。增加该值将使这些文档频率更精确。</td></tr> <tr><td><code>max_inspections</code></td> <td>一个用于与 <code>shards_size</code> 相乘的因子，以便在分片级别检查更多候选拼写更正。可以以牺牲性能为代价提高准确性。默认为 5。</td></tr> <tr><td><code>min_doc_freq</code></td> <td>建议应出现在其中的文档数的最小阈值。这可以指定为绝对数，也可以指定为文档数的相对百分比。这可以通过建议高频项来提高质量。默认为 0f 且未启用。如果指定的值大于 1，则该数字不能是小数。分片级别的文档频率用于此选项。</td></tr> <tr><td><code>max_term_freq</code></td> <td>建议文本标记可以存在以包含在其中的文档数的最大阈值。可以是相对百分比（例如，0.4）或绝对数来表示文档频率。如果指定的值大于1，则不能指定分数。默认值为 0.01f。这可用于排除高频项——通常拼写正确的——避免被拼写检查。这也提高了拼写检查的性能。分片级别的文档频率用于此选项。</td></tr> <tr><td><code>string_distance</code></td> <td>使用哪个字符串距离实现来比较建议术语的相似程度。可以指定五个可能的值：<code>internal</code>：默认值基于damerau_levenshtein，但经过高度优化，用于比较索引内术语的字符串距离。<code>damerau_levenshtein</code>：基于 damerau levenshtein 算法的字符串距离算法。<code>levenshtein</code>：基于 levenshtein 编辑距离算法的字符串距离算法。<code>jaro_winkler</code>：基于 jaro winkler 算法的字符串距离算法。<code>ngram</code>：基于字符 n-grams 的字符串距离算法。</td></tr></tbody></table> <h2 id="短语建议器"><a href="#短语建议器" class="header-anchor">#</a> 短语建议器</h2> <p><code>term</code> 建议器提供了一个非常方便的 API，可以在一定的字符串距离内以每个标记为基础访问单词替代项。API 允许单独访问流中的每个令牌，而建议选择留给 API 使用者。然而，通常需要预先选择的建议才能呈现给最终用户。<code>phrase</code> 建议器在 <code>term</code> 建议器的基础上添加了额外的逻辑，以选择完整的已更正短语，而不是基于 <code>ngram-language</code> 模型加权的单个标记。在实践中，这个建议器将能够根据共现和频率更好地决定选择哪些记号。</p> <h3 id="api-示例"><a href="#api-示例" class="header-anchor">#</a> API 示例</h3> <p>一般来说，<code>phrase</code> 建议器需要在工作前进行特殊映射。本页上的 <code>phrase</code> 提示示例需要以下映射才能工作。<code>reverse</code> 分析器仅在最后一个示例中使用。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>PUT <span class="token builtin class-name">test</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;settings&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;index&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;number_of_shards&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,
      <span class="token string">&quot;analysis&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;analyzer&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;trigram&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;custom&quot;</span>,
            <span class="token string">&quot;tokenizer&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;standard&quot;</span>,
            <span class="token string">&quot;filter&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;lowercase&quot;</span>,<span class="token string">&quot;shingle&quot;</span><span class="token punctuation">]</span>
          <span class="token punctuation">}</span>,
          <span class="token string">&quot;reverse&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;custom&quot;</span>,
            <span class="token string">&quot;tokenizer&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;standard&quot;</span>,
            <span class="token string">&quot;filter&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;lowercase&quot;</span>,<span class="token string">&quot;reverse&quot;</span><span class="token punctuation">]</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>,
        <span class="token string">&quot;filter&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;shingle&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;shingle&quot;</span>,
            <span class="token string">&quot;min_shingle_size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">2</span>,
            <span class="token string">&quot;max_shingle_size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">3</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>,
  <span class="token string">&quot;mappings&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;properties&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;title&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;text&quot;</span>,
        <span class="token string">&quot;fields&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;trigram&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;text&quot;</span>,
            <span class="token string">&quot;analyzer&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;trigram&quot;</span>
          <span class="token punctuation">}</span>,
          <span class="token string">&quot;reverse&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;text&quot;</span>,
            <span class="token string">&quot;analyzer&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;reverse&quot;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
POST test/_doc?refresh<span class="token operator">=</span>true
<span class="token punctuation">{</span><span class="token string">&quot;title&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;noble warriors&quot;</span><span class="token punctuation">}</span>
POST test/_doc?refresh<span class="token operator">=</span>true
<span class="token punctuation">{</span><span class="token string">&quot;title&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;nobel prize&quot;</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><p>一旦设置了分析器和映射，就可以在使用 <code>term</code> 建议器的同一位置使用 <code>phrase</code> 建议器：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>POST test/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;suggest&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;text&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;noble prize&quot;</span>,
    <span class="token string">&quot;simple_phrase&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;phrase&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;field&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;title.trigram&quot;</span>,
        <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,
        <span class="token string">&quot;gram_size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">3</span>,
        <span class="token string">&quot;direct_generator&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;field&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;title.trigram&quot;</span>,
          <span class="token string">&quot;suggest_mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;always&quot;</span>
        <span class="token punctuation">}</span> <span class="token punctuation">]</span>,
        <span class="token string">&quot;highlight&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;pre_tag&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&lt;em&gt;&quot;</span>,
          <span class="token string">&quot;post_tag&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&lt;/em&gt;&quot;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>回复中包含的建议由最有可能的拼写更正者首先评分。在这种情况下，我们收到了预期的更正“nobel prize”。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;_shards&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">..</span>.
  <span class="token string">&quot;hits&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">..</span>.
  <span class="token string">&quot;timed_out&quot;</span><span class="token builtin class-name">:</span> false,
  <span class="token string">&quot;took&quot;</span><span class="token builtin class-name">:</span> <span class="token number">3</span>,
  <span class="token string">&quot;suggest&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;simple_phrase&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">&quot;text&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;noble prize&quot;</span>,
        <span class="token string">&quot;offset&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,
        <span class="token string">&quot;length&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">11</span>,
        <span class="token string">&quot;options&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;text&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;nobel prize&quot;</span>,
          <span class="token string">&quot;highlighted&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&lt;em&gt;nobel&lt;/em&gt; prize&quot;</span>,
          <span class="token string">&quot;score&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0.48614594</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="基本短语建议-api-参数"><a href="#基本短语建议-api-参数" class="header-anchor">#</a> 基本短语建议 API 参数</h3> <table><thead><tr><th></th> <th></th></tr></thead> <tbody><tr><td><code>field</code></td> <td>用于对语言模型进行 n-gram 查找的字段的名称，建议者将使用此字段获取统计信息以对更正进行评分。此字段为必填字段。</td></tr> <tr><td><code>gram_size</code></td> <td>设置 <code>field</code> 中 n-grams（shingle）的最大大小。如果该字段不包含 n-grams（shingle），则应忽略该字段或将其设置为 <code>1</code>。请注意，Elasticsearch 尝试根据指定 <code>field</code> 检测 gram 大小。如果该字段使用 <code>shingle</code> 过滤器，如果未明确设置，则将 <code>gram_size</code> 设置为 <code>max_shingle_size</code>。</td></tr> <tr><td><code>real_word_error_likelihood</code></td> <td>即使词典中存在某个词语，该词语拼写错误的可能性。默认值为 <code>0.95</code>，这意味着 5% 的真实单词拼写错误。</td></tr> <tr><td><code>confidence</code></td> <td>置信度定义了一个应用于输入短语得分的因子，该因子用作其他推荐候选词的阈值。只有得分高于阈值的候选人才会被纳入结果。例如，置信度为 <code>1.0</code> 只会返回得分高于输入短语的建议。如果设置为 <code>0.0</code>，则返回前 N 名候选项。默认值为 <code>1.0</code>。</td></tr> <tr><td><code>max_errors</code></td> <td>为了形成更正，被认为拼写错误的术语的最大百分比。此方法接受范围内的浮点值 <code>[0..1）</code>作为实际查询词的一小部分，或一个 <code>&gt;=1</code> 的数字作为查询词的绝对数。默认值设置为 <code>1.0</code>，这意味着只返回最多一个拼写错误的词的更正。请注意，设置得太高可能会对性能产生负面影响。建议使用 <code>1</code> 或 <code>2</code> 这样的小值，否则将花费时间在建议调用中可能超过查询执行所花费的时间。</td></tr> <tr><td><code>separator</code></td> <td>用于分隔双字符字段中的术语的分隔符。如果未设置，则空格字符用作分隔符。</td></tr> <tr><td><code>size</code></td> <td>为每个查询项生成的候选项数。<code>3</code> 或 <code>5</code> 这样的小数字通常会产生好的结果。提高这个值可以带来编辑距离更大的术语。默认值为 <code>5</code>。</td></tr> <tr><td><code>analyzer</code></td> <td>将要分析的分析器设置为使用建议文本。默认为通过 <code>field</code> 传递的建议字段的搜索分析器。</td></tr> <tr><td><code>shard_size</code></td> <td>设置从每个碎片中检索的建议术语的最大数量。在收缩（reduce）阶段，根据 <code>size</code> 选项只返回前 N 个建议。默认值为 <code>5</code>。</td></tr> <tr><td><code>text</code></td> <td>设置要为其提供建议的文本/查询。</td></tr> <tr><td><code>highlight</code></td> <td>设置建议高亮。如果未提供，则不会返回 <code>highlighted</code> 字段。如果提供，则必须准确地包含 <code>pre_tag</code> 和 <code>post_tag</code>，这两个包裹在已更改的标记（token）周围。如果一行中有多个标记被更改，那么更改的标记的整个短语将被包装，而不是每个标记。</td></tr> <tr><td><code>collate</code></td> <td>根据指定的 <code>query</code> 检查每个建议，以删除索引中不存在匹配文档的建议。建议的collate查询仅在从中生成建议的本地分片上运行。必须指定 <code>query</code>，并且可以对其进行模板化。参阅<a href="/search_your_data/search_templates">搜索模板</a>。当前建议将自动作为 <code></code> 变量提供，该变量应在查询中使用。你仍然可以指定自己的模板 <code>params</code> — <code>suggestion</code> 值将添加到你指定的变量中。此外，你可以指定一个 <code>prune</code> 来控制是否返回所有短语建议；当设置为 <code>true</code> 时，建议将有一个附加选项 <code>collate_match</code>，如果找到匹配短语的文档，则该选项为 <code>true</code>，否则为 <code>false</code>。<code>prune</code> 的默认值为 <code>false</code>。</td></tr></tbody></table> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>POST test/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;suggest&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;text&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;noble prize&quot;</span>,
    <span class="token string">&quot;simple_phrase&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;phrase&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;field&quot;</span> <span class="token builtin class-name">:</span>  <span class="token string">&quot;title.trigram&quot;</span>,
        <span class="token string">&quot;size&quot;</span> <span class="token builtin class-name">:</span>   <span class="token number">1</span>,
        <span class="token string">&quot;direct_generator&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;field&quot;</span> <span class="token builtin class-name">:</span>            <span class="token string">&quot;title.trigram&quot;</span>,
          <span class="token string">&quot;suggest_mode&quot;</span> <span class="token builtin class-name">:</span>     <span class="token string">&quot;always&quot;</span>,
          <span class="token string">&quot;min_word_length&quot;</span> <span class="token builtin class-name">:</span>  <span class="token number">1</span>
        <span class="token punctuation">}</span> <span class="token punctuation">]</span>,
        <span class="token string">&quot;collate&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;source&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
              <span class="token string">&quot;match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;{{field_name}}&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;{{suggestion}}&quot;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>,
          <span class="token string">&quot;params&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&quot;field_name&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;title&quot;</span><span class="token punctuation">}</span>,
          <span class="token string">&quot;prune&quot;</span><span class="token builtin class-name">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><ol><li><code>&quot;query&quot;</code>：此查询将针对每个建议运行一次。</li> <li><code>&quot;&quot; : &quot;&quot;</code>：<code></code> 变量将被每个建议的文本替换。</li> <li><code>&quot;params&quot;: {&quot;field_name&quot; : &quot;title&quot;}</code>：<code>params</code> 中指定了一个额外的 <code>field_name</code> 变量，用于 <code>match</code> 查询。</li> <li><code>&quot;prune&quot;: true</code>：所有建议都将返回一个额外的 <code>collate_match</code> 选项，指示生成的短语是否与任何文档匹配。</li></ol> <h3 id="平滑模型"><a href="#平滑模型" class="header-anchor">#</a> 平滑模型</h3> <p><code>phrase</code> 建议器支持多个平滑模型来平衡不频繁的 grams（grams（shingles）在索引中不存在）和频繁 grams（在索引中至少出现一次）之间的权重。通过将 <code>smoothing</code> 参数设置为以下选项之一，可以选择平滑模型。每个平滑模型都支持可以配置的特定属性。</p> <table><thead><tr><th></th> <th></th></tr></thead> <tbody><tr><td><code>stupid_backoff</code></td> <td>一个简单的退避模型，如果高阶计数为 <code>0</code>，则退避到低阶 n-gram 模型，并通过常数因子对低阶 n-gram 模型进行低估。默认折扣为 <code>0.4</code>Stupid Backoff 是默认模式。</td></tr> <tr><td><code>laplace</code></td> <td>一种使用加法平滑的平滑模型，其中向所有计数添加一个常数（通常为 <code>1.0</code> 或更小）以平衡权重。默认 <code>alpha</code> 为 <code>0.5</code>。</td></tr> <tr><td><code>linear_interpolation</code></td> <td>一种平滑模型，根据用户提供的权重（lambdas），对单图、双图和三联图进行加权平均。线性插值没有任何默认值。必须提供所有参数（<code>trigram_lambda</code>、<code>bigram_lambda</code>、<code>unigram_lambda</code>）。</td></tr></tbody></table> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>POST test/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;suggest&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;text&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;obel prize&quot;</span>,
    <span class="token string">&quot;simple_phrase&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;phrase&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;field&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;title.trigram&quot;</span>,
        <span class="token string">&quot;size&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,
        <span class="token string">&quot;smoothing&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;laplace&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;alpha&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0.7</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="候选生成器"><a href="#候选生成器" class="header-anchor">#</a> 候选生成器</h3> <p><code>phrase</code> 建议器使用候选生成器生成给定文本中每个词语的可能词语列表。单个候选生成器类似于为文本中的每个词语调用的 <code>term</code> 建议器。生成器的输出随后与建议候选项的其他词语中的候选项一起评分。</p> <p>目前只支持一种类型的候选生成器，即 <code>direct_generator</code>。短语建议 API 接受键 <code>direct_generator</code> 下的生成器列表；在原始文本中，列表中的每个生成器都是按词语调用的。</p> <h3 id="直接生成器"><a href="#直接生成器" class="header-anchor">#</a> 直接生成器</h3> <p>直接生成器支持以下参数：</p> <table><thead><tr><th></th> <th></th></tr></thead> <tbody><tr><td><code>field</code></td> <td>获取候选建议的字段。这是一个必需的选项，需要在全局范围内或根据建议进行设置。</td></tr> <tr><td><code>size</code></td> <td>每个建议文本标记返回的最大更正。</td></tr> <tr><td><code>suggest_mode</code></td> <td>建议模式控制在每个碎片上生成的建议中包含哪些建议。除了 <code>always</code> 之外的所有值都可以被认为是一种优化，以在每个分片上生成较少的建议进行测试，并且在组合在每个碎片上生成的建议时不会重新检查。因此，<code>missing</code> 将为不包含它们的分片上的术语生成建议，即使其他分片确实包含它们。这些应该用 <code>confidence</code> 过滤掉。可以指定三个可能的值：<code>missing</code>：仅为不在碎片中的术语生成建议。这是默认设置。<code>popular</code>：只建议出现在比原始术语更多的文档中的术语。<code>always</code>：根据建议文本中的术语提出任何匹配建议。</td></tr> <tr><td><code>max_edits</code></td> <td>候选建议可以具有的最大编辑距离可以被视为建议。只能是介于 1 和 2 之间的值。任何其他值都会导致抛出错误的请求错误。默认值为 2。</td></tr> <tr><td><code>prefix_length</code></td> <td>必须匹配的最小前缀字符数才能成为候选字符。默认值为 1。增加这个数字可以提高拼写检查性能。通常拼写错误不会发生在词语开始时。</td></tr> <tr><td><code>min_word_length</code></td> <td>建议文本词语必须包含的最小长度。默认为 4。</td></tr> <tr><td><code>max_inspections</code></td> <td>一个用于与碎片大小相乘的因子，以便在碎片级别检查更多候选拼写更正。可以以牺牲性能为代价提高准确性。默认值为5。</td></tr> <tr><td><code>min_doc_freq</code></td> <td>建议应出现在其中的文档数的最小阈值。这可以指定为绝对数，也可以指定为文档数的相对百分比。这可以通过建议高频项来提高质量。默认为 0f 且未启用。如果指定的值大于 1，则该数字不能是小数。分片级别的文档频率用于此选项。</td></tr> <tr><td><code>max_term_freq</code></td> <td>建议文本标记可以存在以包含在其中的文档数的最大阈值。可以是相对百分比（例如，0.4）或绝对数来表示文档频率。如果指定的值大于1，则不能指定分数。默认值为 0.01f。这可用于排除高频项——通常拼写正确——避免被拼写检查。这也提高了拼写检查的性能。分片级别的文档频率用于此选项。</td></tr> <tr><td><code>pre_filter</code></td> <td>应用于传递到此候选生成器的每个标识的筛选器（分析器）。在生成候选标识之前，此筛选器将应用于原始标识。</td></tr> <tr><td><code>post_filter</code></td> <td>一个过滤器（分析器），在传递给实际短语记分器之前应用于每个生成的标记。</td></tr></tbody></table> <p>下面的示例显示了一个带有两个生成器的短语建议调用：第一个使用包含普通索引项的字段，第二个使用使用反向过滤器索引的项的字段（标记按反向顺序索引）。这是用来克服直接生成器需要恒定前缀以提供高性能建议的限制。<code>pre_filter</code> 和 <code>post_filter</code> 选项接受普通的分析器名称。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>POST test/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;suggest&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;text&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;obel prize&quot;</span>,
    <span class="token string">&quot;simple_phrase&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;phrase&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;field&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;title.trigram&quot;</span>,
        <span class="token string">&quot;size&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,
        <span class="token string">&quot;direct_generator&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;field&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;title.trigram&quot;</span>,
          <span class="token string">&quot;suggest_mode&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;always&quot;</span>
        <span class="token punctuation">}</span>, <span class="token punctuation">{</span>
          <span class="token string">&quot;field&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;title.reverse&quot;</span>,
          <span class="token string">&quot;suggest_mode&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;always&quot;</span>,
          <span class="token string">&quot;pre_filter&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;reverse&quot;</span>,
          <span class="token string">&quot;post_filter&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;reverse&quot;</span>
        <span class="token punctuation">}</span> <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p><code>pre_filter</code> 和 <code>post_filter</code> 也可用于在生成候选词后注入同义词。例如，对于 <code>captain usq</code> 查询，我们可能会为词语 <code>usq</code> 生成一个候选 <code>usa</code>，<code>usq</code> 是 <code>america</code> 的同义词。如果这个短语得分足够高，我们就可以向用户展示 <code>captain america</code>。</p> <h2 id="完成建议器"><a href="#完成建议器" class="header-anchor">#</a> 完成建议器</h2> <p><code>completion</code> 建议器提供键入时自动完成/搜索功能。这是一种导航功能，可以在用户键入相关结果时引导用户，从而提高搜索精度。它不是为了拼写纠正，或者你指的是像 <code>term</code> 或 <code>phrase</code> 提示器这样的功能。</p> <p>理想情况下，自动完成功能应该与用户键入的内容一样快，以提供与用户已键入内容相关的即时反馈。因此，<code>completion</code> 建议器针对速度进行了优化。建议器使用能够快速查找的数据结构，但构建成本很高，且存储在内存中。</p> <h3 id="映射"><a href="#映射" class="header-anchor">#</a> 映射</h3> <p>要使用此功能，请为此字段指定一个特殊映射，该映射为字段值建立索引，以便快速完成。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>PUT music
<span class="token punctuation">{</span>
  <span class="token string">&quot;mappings&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;properties&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;suggest&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;completion&quot;</span>
      <span class="token punctuation">}</span>,
      <span class="token string">&quot;title&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;keyword&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>映射支持以下参数：</p> <table><thead><tr><th></th> <th></th></tr></thead> <tbody><tr><td><code>analyzer</code></td> <td>将使用的索引分析器，默认为 <code>simple</code>。</td></tr> <tr><td><code>search_analyzer</code></td> <td>将使用的搜索分析器，默认值为 <code>analyzer</code>。</td></tr> <tr><td><code>preserve_separators</code></td> <td>保留分隔符，默认为 <code>true</code>。如果禁用，假如你建议使用 <code>foof</code>，你可能会找到一个以 <code>Foo Fighters</code> 开头的字段。</td></tr> <tr><td><code>preserve_position_increments</code></td> <td>启用位置增量，默认为 <code>true</code>。如果禁用并使用 stopwords analyzer，你可以得到一个以 <code>The Beatles</code> 开始的字段，如果你建议使用 <code>b</code>。注意：你也可以通过索引两个输入，<code>Beatles</code> 和 <code>The Beatles</code> 来实现这一点，如果你能够丰富你的数据，无需更改一个简单的分析器。</td></tr> <tr><td><code>max_input_length</code></td> <td>限制单个输入的长度，默认为 <code>50</code> 个UTF-16代码点。此限制仅在索引时用于减少每个输入字符串的字符总数，以防止大量输入导致底层数据结构膨胀。大多数用例不会受到默认值的影响，因为前缀补全很少超出前缀长度超过少数字符。</td></tr></tbody></table> <h3 id="索引"><a href="#索引" class="header-anchor">#</a> 索引</h3> <p>你可以像其他领域一样索引建议。建议由输入和可选的权重属性组成。输入是建议查询所匹配的预期文本，权重决定建议的评分方式。建议如下：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>PUT music/_doc/1?refresh
<span class="token punctuation">{</span>
  <span class="token string">&quot;suggest&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;input&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;Nevermind&quot;</span>, <span class="token string">&quot;Nirvana&quot;</span> <span class="token punctuation">]</span>,
    <span class="token string">&quot;weight&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">34</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>支持以下参数：</p> <table><thead><tr><th></th> <th></th></tr></thead> <tbody><tr><td><code>input</code></td> <td>要存储的输入，可以是字符串数组，也可以只是字符串。此字段为必填字段。<strong>注意</strong> 此值不能包含以下UTF-16控制字符：<code>\u0000</code>（空） <code>\u001f</code>（信息分隔符一） <code>\u001e</code>（信息分隔符二）</td></tr> <tr><td><code>weight</code></td> <td>一个正整数或一个包含正整数的字符串，用于定义权重并允许你对建议进行排序。此字段是可选的。</td></tr></tbody></table> <p>你可以为一个文档的多个建议编制索引，如下所示：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>PUT music/_doc/1?refresh
<span class="token punctuation">{</span>
  <span class="token string">&quot;suggest&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string">&quot;input&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Nevermind&quot;</span>,
      <span class="token string">&quot;weight&quot;</span><span class="token builtin class-name">:</span> <span class="token number">10</span>
    <span class="token punctuation">}</span>,
    <span class="token punctuation">{</span>
      <span class="token string">&quot;input&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Nirvana&quot;</span>,
      <span class="token string">&quot;weight&quot;</span><span class="token builtin class-name">:</span> <span class="token number">3</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>你可以使用下面的速记形式。请注意，你不能以速记形式指定带有建议的权重。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>PUT music/_doc/1?refresh
<span class="token punctuation">{</span>
  <span class="token string">&quot;suggest&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;Nevermind&quot;</span>, <span class="token string">&quot;Nirvana&quot;</span> <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="查询"><a href="#查询" class="header-anchor">#</a> 查询</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>POST music/_search?pretty
<span class="token punctuation">{</span>
  <span class="token string">&quot;suggest&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;song-suggest&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;prefix&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;nir&quot;</span>,
      <span class="token string">&quot;completion&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;field&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;suggest&quot;</span>  
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ol><li><code>&quot;prefix&quot;: &quot;nir&quot;</code>：用于搜索建议的前缀</li> <li><code>&quot;completion&quot;</code>：建议类型</li> <li><code>&quot;field&quot;: &quot;suggest&quot;</code> ：在其中搜索建议的字段名称</li></ol> <p>返回以下响应：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;_shards&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;total&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,
    <span class="token string">&quot;successful&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,
    <span class="token string">&quot;skipped&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,
    <span class="token string">&quot;failed&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>,
  <span class="token string">&quot;hits&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">..</span>.
  <span class="token string">&quot;took&quot;</span><span class="token builtin class-name">:</span> <span class="token number">2</span>,
  <span class="token string">&quot;timed_out&quot;</span><span class="token builtin class-name">:</span> false,
  <span class="token string">&quot;suggest&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;song-suggest&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;text&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;nir&quot;</span>,
      <span class="token string">&quot;offset&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,
      <span class="token string">&quot;length&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">3</span>,
      <span class="token string">&quot;options&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;text&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;Nirvana&quot;</span>,
        <span class="token string">&quot;_index&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;music&quot;</span>,
        <span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;1&quot;</span>,
        <span class="token string">&quot;_score&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1.0</span>,
        <span class="token string">&quot;_source&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;suggest&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Nevermind&quot;</span>, <span class="token string">&quot;Nirvana&quot;</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token punctuation">]</span>
    <span class="token punctuation">}</span> <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><div class="custom-block danger"><p class="custom-block-title">警告</p> <p><code>_source</code> 源元数据字段必须启用（这是默认行为），才能使用建议返回 <code>_source</code>。</p></div> <p>建议的配置权重作为 <code>_source</code> 返回。<code>text</code> 字段使用索引建议的 <code>input</code>。默认情况下，建议返回完整的文档 <code>_source</code>。由于磁盘提取和网络传输开销，<code>_source</code> 的大小可能会影响性能。为了节省一些网络开销，请使用<a href="/search_your_data/retrieve_selected_fields#_source-%E9%80%89%E9%A1%B9">源过滤</a>从 <code>_source</code> 中筛选出不必要的字段，以最小化 <code>_source</code> 的大小。请注意 <code>_suggest</code> 端点不支持源过滤，但在 <code>_search</code> 端点上可以使用建议：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>POST music/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;_source&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;suggest&quot;</span>,
  <span class="token string">&quot;suggest&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;song-suggest&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;prefix&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;nir&quot;</span>,
      <span class="token string">&quot;completion&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;field&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;suggest&quot;</span>,
        <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">5</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ol><li><code>&quot;_source&quot;: &quot;suggest&quot;</code>：过滤源以仅返回 <code>suggest</code> 字段</li> <li><code>&quot;field&quot;: &quot;suggest&quot;</code>：要在其中搜索建议的字段的名称</li> <li><code>&quot;size&quot;: 5</code>：要返回的建议数</li></ol> <p>结果类似如下：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;took&quot;</span><span class="token builtin class-name">:</span> <span class="token number">6</span>,
  <span class="token string">&quot;timed_out&quot;</span><span class="token builtin class-name">:</span> false,
  <span class="token string">&quot;_shards&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;total&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,
    <span class="token string">&quot;successful&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,
    <span class="token string">&quot;skipped&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
    <span class="token string">&quot;failed&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>,
  <span class="token string">&quot;hits&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;total&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;value&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
      <span class="token string">&quot;relation&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;eq&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;max_score&quot;</span><span class="token builtin class-name">:</span> null,
    <span class="token string">&quot;hits&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>,
  <span class="token string">&quot;suggest&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;song-suggest&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;text&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;nir&quot;</span>,
        <span class="token string">&quot;offset&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
        <span class="token string">&quot;length&quot;</span><span class="token builtin class-name">:</span> <span class="token number">3</span>,
        <span class="token string">&quot;options&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;text&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Nirvana&quot;</span>,
            <span class="token string">&quot;_index&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;music&quot;</span>,
            <span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;1&quot;</span>,
            <span class="token string">&quot;_score&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1.0</span>,
            <span class="token string">&quot;_source&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
              <span class="token string">&quot;suggest&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;Nevermind&quot;</span>, <span class="token string">&quot;Nirvana&quot;</span> <span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span> <span class="token punctuation">]</span>
      <span class="token punctuation">}</span> <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>基本完成建议查询支持以下参数：</p> <table><thead><tr><th></th> <th></th></tr></thead> <tbody><tr><td><code>field</code></td> <td>要在其上运行查询的字段的名称（必填）。</td></tr> <tr><td><code>size</code></td> <td>要返回的建议数（默认为 <code>5</code>）。</td></tr> <tr><td><code>skip_duplicates</code></td> <td>是否应过滤重复建议（默认为 <code>false</code>）。</td></tr></tbody></table> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>完成建议器考虑索引中的所有文档。有关如何查询文档子集的说明，参阅<a href="/rest_apis/search_apis/suggeters#%E4%B8%8A%E4%B8%8B%E6%96%87%E5%BB%BA%E8%AE%AE%E5%99%A8">上下文建议器</a>。</p></div> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>如果完成查询跨越多个分片，建议分两个阶段执行，其中最后一个阶段从分片获取相关文档，这意味着针对单个分片执行完成请求的性能更高，因为当建议跨越多个分片时，文档获取开销更大。为了获得最佳的完成性能，建议将完成索引到单个分片索引中。如果由于分片大小导致堆使用率较高，仍然建议将索引拆分为多个分片，而不是优化完成性能。</p></div> <h3 id="跳过重复的建议"><a href="#跳过重复的建议" class="header-anchor">#</a> 跳过重复的建议</h3> <p>查询可以返回来自不同文档的重复建议。可以通过将 <code>skip_duplicates</code> 设置为 <code>true</code> 来修改此行为。设置后，此选项会从结果中过滤出包含重复建议的文档。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>POST music/_search?pretty
<span class="token punctuation">{</span>
  <span class="token string">&quot;suggest&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;song-suggest&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;prefix&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;nor&quot;</span>,
      <span class="token string">&quot;completion&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;field&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;suggest&quot;</span>,
        <span class="token string">&quot;skip_duplicates&quot;</span><span class="token builtin class-name">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="custom-block danger"><p class="custom-block-title">警告</p> <p>当设置为 <code>true</code> 时，此选项会减慢搜索速度，因为需要访问更多建议才能找到前 N 个。</p></div> <h3 id="模糊查询"><a href="#模糊查询" class="header-anchor">#</a> 模糊查询</h3> <p>完成建议器还支持模糊查询——这意味着你可以在搜索中输错，但仍然可以获得返回结果。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>POST music/_search?pretty
<span class="token punctuation">{</span>
  <span class="token string">&quot;suggest&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;song-suggest&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;prefix&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;nor&quot;</span>,
      <span class="token string">&quot;completion&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;field&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;suggest&quot;</span>,
        <span class="token string">&quot;fuzzy&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;fuzziness&quot;</span><span class="token builtin class-name">:</span> <span class="token number">2</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>与查询 <code>prefix</code> 共享最长前缀的建议将获得更高的分数。</p> <p>模糊查询可以采用特定的模糊参数。支持以下参数：</p> <table><thead><tr><th></th> <th></th></tr></thead> <tbody><tr><td><code>fuzziness</code></td> <td>模糊因子默认为 <code>auto</code>。有关允许的设置，参阅<a href="/rest_apis/common_options#%E6%A8%A1%E7%B3%8A%E6%80%A7">模糊性</a>。</td></tr> <tr><td><code>transpositions</code></td> <td>如果设置为 <code>true</code>，则换位计算为一次更改，而不是两次，默认为 <code>true</code></td></tr> <tr><td><code>min_length</code></td> <td>返回模糊建议前输入的最小长度，默认值为 <code>3</code></td></tr> <tr><td><code>prefix_length</code></td> <td>输入的最小长度默认为 <code>1</code>，不检查模糊选项</td></tr> <tr><td><code>unicode_aware</code></td> <td>如果为 <code>true</code>，则所有度量（如模糊编辑距离、换位和长度）都以 Unicode 码点而不是字节来度量。这比原始字节稍慢，因此默认设置为 <code>false</code>。</td></tr></tbody></table> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>如果你想坚持使用默认值，但仍然使用fuzzy，可以使用 <code>fuzzy:{}</code> 或 <code>fuzzy:true</code>。</p></div> <h3 id="正则查询"><a href="#正则查询" class="header-anchor">#</a> 正则查询</h3> <p>完成建议器还支持正则表达式查询，这意味着你可以将前缀表示为正则表达式。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>POST music/_search?pretty
<span class="token punctuation">{</span>
  <span class="token string">&quot;suggest&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;song-suggest&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;regex&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;n[ever|i]r&quot;</span>,
      <span class="token string">&quot;completion&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;field&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;suggest&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>正则查询可以采用特定的正则参数。支持以下参数：</p> <table><thead><tr><th></th> <th></th></tr></thead> <tbody><tr><td><code>flags</code></td> <td>可能的标志有 <code>ALL</code>（默认）、<code>ANYSTRING</code>、<code>COMPLEMENT</code>、<code>EMPTY</code>、<code>INTERSECTION</code>、<code>INTERVAL</code> 或 <code>NONE</code>。参阅<a href="/query_dsl/term-level_queries/regexp">正则表达式语法</a>了解其含义</td></tr> <tr><td><code>max_determinized_states</code></td> <td>正则表达式是危险的，因为它很容易意外地创建一个看起来无害的表达式，它需要大量内部确定的自动机状态（以及相应的 RAM 和 CPU）供 Lucene 执行。Lucene 使用 <code>max_determinized_states</code> 设置（默认值为 10000）防止这些情况发生。可以提高此限制，以允许执行更复杂的正则表达式。</td></tr></tbody></table> <h2 id="上下文建议器"><a href="#上下文建议器" class="header-anchor">#</a> 上下文建议器</h2> <p>完成建议器会考虑索引中的所有文档，但通常需要提供经过筛选和/或通过某些标准增强的建议。例如，你希望建议由某些艺术家筛选的歌曲标题，或者希望根据他们的流派增加歌曲标题。</p> <p>要实现建议过滤和/或增强，可以在配置完成字段时添加上下文映射。可以为一个完成字段定义多个上下文映射。每个上下文映射都有一个唯一的名称和类型。有两种类型：<code>category</code> 和 <code>geo</code>。上下文映射在字段映射中的 <code>contexts</code> 参数下配置。</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>索引和查询启用上下文的完成字段时，必须提供上下文。</p></div> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>允许的最大完成字段上下文映射数为 10。</p></div> <p>以下定义了类型，每个类型都有两个用于完成字段的上下文映射：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>PUT place
<span class="token punctuation">{</span>
  <span class="token string">&quot;mappings&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;properties&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;suggest&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;completion&quot;</span>,
        <span class="token string">&quot;contexts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;place_type&quot;</span>,
            <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;category&quot;</span>
          <span class="token punctuation">}</span>,
          <span class="token punctuation">{</span>
            <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;location&quot;</span>,
            <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;geo&quot;</span>,
            <span class="token string">&quot;precision&quot;</span><span class="token builtin class-name">:</span> <span class="token number">4</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><ol><li><code>&quot;type&quot;: &quot;category&quot;</code>： 定义一个名为 <code>place_type</code> 的 <code>category</code> 上下文，类别必须与建议一起发送。</li> <li><code>&quot;type&quot;: &quot;geo&quot;</code>：定义一个名为 <code>location</code> 的 <code>geo</code> 上下文，类别必须与建议一起发送到该位置。</li></ol> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>PUT place_path_category
<span class="token punctuation">{</span>
  <span class="token string">&quot;mappings&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;properties&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;suggest&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;completion&quot;</span>,
        <span class="token string">&quot;contexts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;place_type&quot;</span>,
            <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;category&quot;</span>,
            <span class="token string">&quot;path&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;cat&quot;</span>
          <span class="token punctuation">}</span>,
          <span class="token punctuation">{</span>
            <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;location&quot;</span>,
            <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;geo&quot;</span>,
            <span class="token string">&quot;precision&quot;</span><span class="token builtin class-name">:</span> <span class="token number">4</span>,
            <span class="token string">&quot;path&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;loc&quot;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>,
      <span class="token string">&quot;loc&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;geo_point&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><ol><li><code>&quot;type&quot;: &quot;category&quot;</code>：定义一个名为 <code>place_type</code> 的 <code>category</code> 上下文，从 <code>cat</code> 字段中读取类别。</li> <li><code>&quot;type&quot;: &quot;geo&quot;</code>：定义一个名为 <code>location</code> 的 <code>geo</code> 上下文，从 <code>loc</code> 字段中读取类别。</li></ol> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>添加上下文映射会增加完成字段的索引大小。完成索引完全驻留在堆中，你可以使用<a href="/rest_apis/index_apis/index_stats">索引统计</a>信息监视完成字段索引大小。</p></div> <h3 id="类别上下文"><a href="#类别上下文" class="header-anchor">#</a> 类别上下文</h3> <p><code>category</code> 上下文允许你在索引时将一个或多个类别与建议关联。在查询时，建议可以通过其关联的类别进行过滤和增强。</p> <p>映射的设置与上面的 <code>place_type</code> 字段类似。如果定义了 <code>path</code>，则从文档中的该路径读取类别，否则它们必须在建议字段中发送，如下所示：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>PUT place/_doc/1
<span class="token punctuation">{</span>
  <span class="token string">&quot;suggest&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;input&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;timmy's&quot;</span>, <span class="token string">&quot;starbucks&quot;</span>, <span class="token string">&quot;dunkin donuts&quot;</span> <span class="token punctuation">]</span>,
    <span class="token string">&quot;contexts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;place_type&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;cafe&quot;</span>, <span class="token string">&quot;food&quot;</span> <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ol><li><code>&quot;place_type&quot;: [ &quot;cafe&quot;, &quot;food&quot; ]</code>：这些建议将与 <em>cafe</em> 和 <em>food</em> 类别相关联。</li></ol> <p>如果映射有路径，那么以下索引请求就足以添加类别：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>PUT place_path_category/_doc/1
<span class="token punctuation">{</span>
  <span class="token string">&quot;suggest&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;timmy's&quot;</span>, <span class="token string">&quot;starbucks&quot;</span>, <span class="token string">&quot;dunkin donuts&quot;</span><span class="token punctuation">]</span>,
  <span class="token string">&quot;cat&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;cafe&quot;</span>, <span class="token string">&quot;food&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol><li><code>&quot;cat&quot;: [&quot;cafe&quot;, &quot;food&quot;]</code>： 这些建议将与 <em>cafe</em> 和 <em>food</em> 类别相关联。</li></ol> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>如果上下文映射引用了另一个字段，并且对类别进行了显式索引，则建议将使用这两组类别进行索引。</p></div> <h3 id="类别查询"><a href="#类别查询" class="header-anchor">#</a> 类别查询</h3> <p>建议可以按一个或多个类别过滤。以下按多个类别筛选建议：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>POST place/_search?pretty
<span class="token punctuation">{</span>
  <span class="token string">&quot;suggest&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;place_suggestion&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;prefix&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;tim&quot;</span>,
      <span class="token string">&quot;completion&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;field&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;suggest&quot;</span>,
        <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">10</span>,
        <span class="token string">&quot;contexts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;place_type&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;cafe&quot;</span>, <span class="token string">&quot;restaurants&quot;</span> <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>如果在查询中设置了多个类别或类别上下文，它们将作为析取合并。这意味着，如果建议至少包含一个提供的上下文值，则建议匹配。</p></div> <p>某些类别的建议可以比其他类别的建议更高。以下内容按类别过滤建议，并进一步增强与某些类别相关的建议：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>POST place/_search?pretty
<span class="token punctuation">{</span>
  <span class="token string">&quot;suggest&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;place_suggestion&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;prefix&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;tim&quot;</span>,
      <span class="token string">&quot;completion&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;field&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;suggest&quot;</span>,
        <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">10</span>,
        <span class="token string">&quot;contexts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;place_type&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span> <span class="token string">&quot;context&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;cafe&quot;</span> <span class="token punctuation">}</span>,
            <span class="token punctuation">{</span> <span class="token string">&quot;context&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;restaurants&quot;</span>, <span class="token string">&quot;boost&quot;</span><span class="token builtin class-name">:</span> <span class="token number">2</span> <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><ol><li><code>&quot;place_type&quot;</code>：上下文查询过滤与类别咖啡馆和餐馆相关的建议，并将与餐馆相关的建议提高 2 倍</li></ol> <p>除了接受类别值外，上下文查询还可以由多个类别上下文子句组成。类别上下文子句支持以下参数：</p> <table><thead><tr><th></th> <th></th></tr></thead> <tbody><tr><td><code>context</code></td> <td>要过滤/增强的类别的值。这是强制性的。</td></tr> <tr><td><code>boost</code></td> <td>建议得分的提升因子，通过将提升值乘以建议权重来计算得分，默认为 <code>1</code></td></tr> <tr><td><code>prefix</code></td> <td>类别值是否应被视为前缀。例如，如果设置为 <code>true</code>，则可以通过指定 <em>type</em> 的类别前缀来过滤 <em>type1</em>、<em>type2</em> 等的类别。默认为 <code>false</code></td></tr></tbody></table> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>如果一个建议条目匹配多个上下文，则最终分数将计算为任何匹配上下文产生的最大分数。</p></div> <h3 id="地理位置上下文"><a href="#地理位置上下文" class="header-anchor">#</a> 地理位置上下文</h3> <p><code>geo</code> 上下文允许你在索引时将一个或多个地理点或地理哈希与建议关联。在查询时，如果建议位于指定地理位置的特定距离内，则可以对其进行过滤和增强。</p> <p>在内部，地理点被编码为具有指定精度的地理哈希。</p> <h4 id="地理映射"><a href="#地理映射" class="header-anchor">#</a> 地理映射</h4> <p>除 <code>path</code> 设置外，<code>geo</code> 上下文映射还接受以下设置：</p> <table><thead><tr><th></th> <th></th></tr></thead> <tbody><tr><td><code>precision</code></td> <td>这定义了要索引的地理哈希（geohash）的精度，可以指定为距离值（<code>5m</code>、<code>10km</code>等），也可以指定为原始地理哈希精度（<code>1</code>..<code>12</code>）。默认为原始地理哈希精度值 <code>6</code>。</td></tr></tbody></table> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>索引时间 <code>precision</code> 设置设置可在查询时使用的最大地理哈希精度。</p></div> <h4 id="索引地理上下文"><a href="#索引地理上下文" class="header-anchor">#</a> 索引地理上下文</h4> <p><code>geo</code> 上下文可以通过建议显式设置，或者通过 <code>path</code> 参数从文档中的地理点字段建立索引，类似于 <code>category</code> 上下文。将多个地理位置上下文与建议关联，将为每个地理位置的建议编制索引。以下索引包含两个地理位置上下文：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>PUT place/_doc/1
<span class="token punctuation">{</span>
 <span class="token string">&quot;suggest&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
   <span class="token string">&quot;input&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;timmy's&quot;</span>,
   <span class="token string">&quot;contexts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
     <span class="token string">&quot;location&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
       <span class="token punctuation">{</span>
         <span class="token string">&quot;lat&quot;</span><span class="token builtin class-name">:</span> <span class="token number">43.6624803</span>,
         <span class="token string">&quot;lon&quot;</span><span class="token builtin class-name">:</span> <span class="token parameter variable">-79.3863353</span>
       <span class="token punctuation">}</span>,
       <span class="token punctuation">{</span>
         <span class="token string">&quot;lat&quot;</span><span class="token builtin class-name">:</span> <span class="token number">43.6624718</span>,
         <span class="token string">&quot;lon&quot;</span><span class="token builtin class-name">:</span> <span class="token parameter variable">-79.3873227</span>
       <span class="token punctuation">}</span>
     <span class="token punctuation">]</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="地理位置查询"><a href="#地理位置查询" class="header-anchor">#</a> 地理位置查询</h3> <p>建议可以根据它们与一个或多个地理点的距离进行过滤和增强。以下过滤属于由地理点的编码地理哈希表示的区域内的建议：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>POST place/_search
<span class="token punctuation">{</span>
  <span class="token string">&quot;suggest&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;place_suggestion&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;prefix&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;tim&quot;</span>,
      <span class="token string">&quot;completion&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;field&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;suggest&quot;</span>,
        <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">10</span>,
        <span class="token string">&quot;contexts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;location&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;lat&quot;</span><span class="token builtin class-name">:</span> <span class="token number">43.662</span>,
            <span class="token string">&quot;lon&quot;</span><span class="token builtin class-name">:</span> <span class="token parameter variable">-79.380</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>当指定查询时精度较低的位置时，将考虑该区域内的所有建议。</p></div> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>如果在查询中设置了多个类别或类别上下文，它们将作为析取合并。这意味着，如果建议至少包含一个提供的上下文值，则建议匹配。</p></div> <p>在地理哈希表示的区域内的建议也可以比其他建议更高，如下所示：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>POST place/_search?pretty
<span class="token punctuation">{</span>
  <span class="token string">&quot;suggest&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;place_suggestion&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;prefix&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;tim&quot;</span>,
      <span class="token string">&quot;completion&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;field&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;suggest&quot;</span>,
        <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">10</span>,
        <span class="token string">&quot;contexts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;location&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                      <span class="token punctuation">{</span>
              <span class="token string">&quot;lat&quot;</span><span class="token builtin class-name">:</span> <span class="token number">43.6624803</span>,
              <span class="token string">&quot;lon&quot;</span><span class="token builtin class-name">:</span> -79.3863353,
              <span class="token string">&quot;precision&quot;</span><span class="token builtin class-name">:</span> <span class="token number">2</span>
            <span class="token punctuation">}</span>,
            <span class="token punctuation">{</span>
              <span class="token string">&quot;context&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;lat&quot;</span><span class="token builtin class-name">:</span> <span class="token number">43.6624803</span>,
                <span class="token string">&quot;lon&quot;</span><span class="token builtin class-name">:</span> <span class="token parameter variable">-79.3863353</span>
              <span class="token punctuation">}</span>,
              <span class="token string">&quot;boost&quot;</span><span class="token builtin class-name">:</span> <span class="token number">2</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><ol><li><code>&quot;location&quot;</code>：上下文查询过滤属于地理哈希 <em>（43.662，-79.380）</em> 表示的地理位置的建议（精度为 <em>2</em>），并将属于地理哈希 <em>（43.6624803，-79.3863353）</em> 表示的建议（默认精度为 <em>6</em>）的建议提升 2 倍</li></ol> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>如果一个建议条目匹配多个上下文，则最终分数将计算为任何匹配上下文产生的最大分数。</p></div> <p>除了接受上下文值之外，上下文查询还可以由多个上下文子句组成。<code>geo</code> 上下文子句支持以下参数：</p> <table><thead><tr><th></th> <th></th></tr></thead> <tbody><tr><td><code>context</code></td> <td>用于过滤或增强建议的地理点对象或地理哈希字符串。这是强制性的。</td></tr> <tr><td><code>boost</code></td> <td>建议得分的提升因子，通过将提升值乘以建议权重来计算得分，默认为 1</td></tr> <tr><td><code>precision</code></td> <td>对查询地理点进行编码的地理哈希的精度。这可以指定为距离值（<code>5m</code>、<code>10km</code> 等），也可以指定为原始geohash精度（<code>1</code>..<code>12</code>）。默认为索引时间精度级别。</td></tr> <tr><td><code>neighbours</code></td> <td>接受一个精度值数组，在该数组中应考虑相邻的地理哈希。精度值可以是距离值（<code>5m</code>、<code>10km</code> 等）或原始geohash精度（1..12）。默认为生成索引时间精度级别的邻居。</td></tr></tbody></table> <h2 id="返回建议器类型"><a href="#返回建议器类型" class="header-anchor">#</a> 返回建议器类型</h2> <p>有时你需要知道建议者的确切类型，以便分析其结果。<code>typed_keys</code> 参数可用于更改响应中建议者的名称，以便以其类型作为前缀。</p> <p>考虑以下两个建议 <code>term</code> 和 <code>phrase</code> 的示例：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>POST _search?typed_keys
<span class="token punctuation">{</span>
  <span class="token string">&quot;suggest&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;text&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;some test mssage&quot;</span>,
    <span class="token string">&quot;my-first-suggester&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;term&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;field&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;message&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;my-second-suggester&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;phrase&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;field&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;message&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>在回复中，建议者的名称将分别更改为 <code>term#my-first-suggester</code> 和 <code>phrase#my-second-suggester</code>，以反映每个建议的类型：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;suggest&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;term#my-first-suggester&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span> 
      <span class="token punctuation">{</span>
        <span class="token string">&quot;text&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;some&quot;</span>,
        <span class="token string">&quot;offset&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
        <span class="token string">&quot;length&quot;</span><span class="token builtin class-name">:</span> <span class="token number">4</span>,
        <span class="token string">&quot;options&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>,
      <span class="token punctuation">{</span>
        <span class="token string">&quot;text&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;test&quot;</span>,
        <span class="token string">&quot;offset&quot;</span><span class="token builtin class-name">:</span> <span class="token number">5</span>,
        <span class="token string">&quot;length&quot;</span><span class="token builtin class-name">:</span> <span class="token number">4</span>,
        <span class="token string">&quot;options&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>,
      <span class="token punctuation">{</span>
        <span class="token string">&quot;text&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;mssage&quot;</span>,
        <span class="token string">&quot;offset&quot;</span><span class="token builtin class-name">:</span> <span class="token number">10</span>,
        <span class="token string">&quot;length&quot;</span><span class="token builtin class-name">:</span> <span class="token number">6</span>,
        <span class="token string">&quot;options&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token string">&quot;text&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;message&quot;</span>,
            <span class="token string">&quot;score&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0.8333333</span>,
            <span class="token string">&quot;freq&quot;</span><span class="token builtin class-name">:</span> <span class="token number">4</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>,
    <span class="token string">&quot;phrase#my-second-suggester&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span> 
      <span class="token punctuation">{</span>
        <span class="token string">&quot;text&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;some test mssage&quot;</span>,
        <span class="token string">&quot;offset&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
        <span class="token string">&quot;length&quot;</span><span class="token builtin class-name">:</span> <span class="token number">16</span>,
        <span class="token string">&quot;options&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token string">&quot;text&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;some test message&quot;</span>,
            <span class="token string">&quot;score&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0.030227963</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>,
  <span class="token punctuation">..</span>.
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><ol><li><code>&quot;term#my-first-suggester&quot;</code>：<code>my-first-suggester</code>的名字现在包含了 <code>term</code> 前缀。</li> <li><code>&quot;phrase#my-second-suggester&quot;</code>：<code>my-second-suggester</code> 的名字现在包含 <code>phrase</code> 前缀。</li></ol> <blockquote><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-suggesters.html" target="_blank" rel="noopener noreferrer">原文链接<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/rest_apis/search_apis/knn_search.html" class="prev">
        kNN 搜索
      </a></span> <span class="next"><a href="/rest_apis/search_apis/terms_enum.html">
        词语枚举
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.f54b6f9f.js" defer></script><script src="/assets/js/2.c3078b94.js" defer></script><script src="/assets/js/108.684c837a.js" defer></script>
  </body>
</html>
