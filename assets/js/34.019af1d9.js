(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{314:function(t,a,e){"use strict";e.r(a);var s=e(13),l=Object(s.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"索引名中的日期数学支持"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#索引名中的日期数学支持"}},[t._v("#")]),t._v(" 索引名中的日期数学支持")]),t._v(" "),a("p",[t._v("日期数学索引名字解析允许你搜索一系列时序索引，而不是搜索所有时序索引并过滤结果或维护别名。限制搜索的索引数可以减少集群上的负载并改进执行性能。例如，如果你在每日日志中搜索错误，你可以使用日期数学名字模板来限制搜索为过去两天。")]),t._v(" "),a("p",[t._v("几乎所有具有 "),a("code",[t._v("index")]),t._v("（索引）参数的 API，都支持 "),a("code",[t._v("index")]),t._v("（索引）参数值中的日期数学。")]),t._v(" "),a("p",[t._v("日期数学索引名字采用以下形式：")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("static_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("date_math_expr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("date_format"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("time_zone"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("其中：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}}),t._v(" "),a("th",{staticStyle:{"text-align":"left"}})])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("static_name")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("名字的静态文字部分")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("date_math_expr")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("动态计算日期的动态日期数学表达式")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("date_format")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("显示计算日期的可选格式。默认为 "),a("code",[t._v("yyyy.MM.dd")]),t._v("。格式应与 java-time 兼容。"),a("a",{attrs:{href:"https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("time_zone")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("可选的时区。默认为 "),a("code",[t._v("utc")]),t._v("。")])])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[a("code",[t._v("date_format")]),t._v("（日期格式）中使用的大小写字母。例如，"),a("code",[t._v("mm")]),t._v(" 表示分钟，"),a("code",[t._v("MM")]),t._v("表示月份。类似的，"),a("code",[t._v("hh")]),t._v(" 表示 "),a("code",[t._v("1-12")]),t._v(" 范围内的小时，与 "),a("code",[t._v("AM/PM")]),t._v(" 组合使用，而 "),a("code",[t._v("HH")]),t._v(" 表示 "),a("code",[t._v("0-23")]),t._v(" 24小时范围内的小时。")])]),t._v(" "),a("p",[t._v("日期数学表达式与区域无关。因此，不以使用格列高利历之外的日历。")]),t._v(" "),a("p",[t._v("必须将日期数学索引名字表达式包在尖括号内，并且所有特殊字符都应进行 URI 编码。例如：")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# PUT /<my-index-{now/d}>")]),t._v("\nPUT /%3Cmy-index-%7Bnow%2Fd%7D%3E\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("日期数学字符的百分比编码"),a("br"),t._v("\n日期格式特定字符必须为 URI 编码，如下：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}}),t._v(" "),a("th",{staticStyle:{"text-align":"left"}})])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("<")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("%3C")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v(">")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("%3E")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("/")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("%2F")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("{")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("%7B")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("}")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("%7D")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("|")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("%7C")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("+")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("%2B")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v(":")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("%3A")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v(",")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("%2C")])])])])]),t._v(" "),a("p",[t._v("以下示例显示日期数学索引名字的不同格式，且给定当前时间为 UTC 2024年3月22日中午，它们解析为最终索引名字。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("表达式")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("解析为")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("<logstash-{now/d}>")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("logstash-2024.03.22")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("<logstash-{now/M}>")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("logstash-2024.03.01")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("<logstash-{now/M{yyyy.MM}}>")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("logstash-2024.03")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("<logstash-{now/M-1M{yyyy.MM}}>")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("logstash-2024.02")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("<logstash-{now/d{yyyy.MM.dd | +12:00}}>")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("logstash-2024.03.23")])])])]),t._v(" "),a("p",[t._v("为了在索引名字模板的静态部分中使用字符 { 和 }，请使用反斜杠 \\ 转义，例如：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("<elastic\\{ON\\}-{now/M}>")]),t._v(" 解析为 "),a("code",[t._v("elastic{ON}-2024.03.01")])])]),t._v(" "),a("p",[t._v("以下例子展示了一个搜索请求，该请求搜索过去三天的 Logstash 索引，假设索引使用默认的 Logstash 索引名字格式 "),a("code",[t._v("logstash-yyyy.MM.dd")]),t._v("。")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# GET /<logstash-{now/d-2d}>,<logstash-{now/d-1d}>,<logstash-{now/d}>/_search")]),t._v("\nGET /%3Clogstash-%7Bnow%2Fd-2d%7D%3E%2C%3Clogstash-%7Bnow%2Fd-1d%7D%3E%2C%3Clogstash-%7Bnow%2Fd%7D%3E/_search\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"query"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"match"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"data"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])]),a("blockquote",[a("p",[a("a",{attrs:{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/date-math-index-names.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("原文链接"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=l.exports}}]);