(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{298:function(e,_,a){"use strict";a.r(_);var s=a(13),t=Object(s.a)({},(function(){var e=this,_=e._self._c;return _("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[_("h1",{attrs:{id:"索引块"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#索引块"}},[e._v("#")]),e._v(" 索引块")]),e._v(" "),_("p",[e._v("索引块限制对指定的索引的可用的操作类型。这些块有不同的风格，可以阻止写、读或元数据操作。块可以通过动态索引设置来设置/移除，也可以通过专用API添加，这也可以确保写入块一旦成功返回用户，所有索引分片都能正确地计算该块，例如，在添加写块后，所有对索引进行中的写入会完成。")]),e._v(" "),_("h2",{attrs:{id:"索引块设置"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#索引块设置"}},[e._v("#")]),e._v(" 索引块设置")]),e._v(" "),_("p",[e._v("以下的"),_("em",[e._v("动态")]),e._v("（dynamic）索引设置会影响索引上已存在的块：")]),e._v(" "),_("ul",[_("li",[_("code",[e._v("index.blocks.read_only")])])]),e._v(" "),_("p",[e._v("设置 "),_("code",[e._v("true")]),e._v(" 时，索引及索引元数据只读，"),_("code",[e._v("false")]),e._v(" 允许写以及元数据变更。")]),e._v(" "),_("ul",[_("li",[_("code",[e._v("index.blocks.read_only_allow_delete")])])]),e._v(" "),_("p",[e._v("类似于 "),_("code",[e._v("index.blocks.read_only")]),e._v("，但也允许删除索引以获取更多资源。"),_("a",{attrs:{href:"/set_up_elasticsearch/configuring_elasticsearch/cluster_level_shard_allocation_and_routing_settings#%E5%9F%BA%E4%BA%8E%E7%A1%AC%E7%9B%98%E7%9A%84%E5%88%86%E7%89%87%E5%88%86%E9%85%8D%E8%AE%BE%E7%BD%AE"}},[e._v("基于硬盘的分片分配器")]),e._v("可以自动添加和移除块。")]),e._v(" "),_("p",[e._v("从索引中删除文档以释放资源——而不是删除索引本身——随着时间推移会增加索引大小。当 "),_("code",[e._v("index.blocks.read_only_allow_delete")]),e._v(" 设置为 "),_("code",[e._v("true")]),e._v(" 时，删除索引是不允许的。然而，删除索引自身会释放只读索引块，并使资源几乎立即可用。")]),e._v(" "),_("div",{staticClass:"custom-block danger"},[_("p",{staticClass:"custom-block-title"},[e._v("警告")]),e._v(" "),_("p",[e._v("在磁盘利用率低于高水位线时，Elasticsearch 自动添加和移除只读索引块，由 "),_("a",{attrs:{href:"/set_up_elasticsearch/configuring_elasticsearch/cluster_level_shard_allocation_and_routing_settings"}},[e._v("cluster.routing.allocation.disk.watermark.flood_stage")]),e._v(" 控制。")])]),e._v(" "),_("ul",[_("li",[_("code",[e._v("index.blocks.read")])])]),e._v(" "),_("p",[e._v("设置为 "),_("code",[e._v("true")]),e._v("，可禁用对索引的读取操作。")]),e._v(" "),_("ul",[_("li",[_("code",[e._v("index.blocks.write")])])]),e._v(" "),_("p",[e._v("设置为 "),_("code",[e._v("true")]),e._v("，可禁用对索引的数据写操作。不像 "),_("code",[e._v("read_only")]),e._v("，这个设置不会影响元数据。例如，你可以用 "),_("code",[e._v("write")]),e._v("（写）块关闭索引，但不能用 "),_("code",[e._v("read_only")]),e._v("(只读)块关闭索引。")]),e._v(" "),_("ul",[_("li",[_("code",[e._v("index.blocks.metadata")])])]),e._v(" "),_("p",[e._v("设置为 "),_("code",[e._v("true")]),e._v("，禁用索引元数据读写。")]),e._v(" "),_("h2",{attrs:{id:"添加索引块-api"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#添加索引块-api"}},[e._v("#")]),e._v(" 添加索引块 API")]),e._v(" "),_("p",[e._v("为索引添加一个索引块。")]),e._v(" "),_("div",{staticClass:"language-bash line-numbers-mode"},[_("pre",{pre:!0,attrs:{class:"language-bash"}},[_("code",[e._v("PUT /my-index-000001/_block/write\n")])]),e._v(" "),_("div",{staticClass:"line-numbers-wrapper"},[_("span",{staticClass:"line-number"},[e._v("1")]),_("br")])]),_("h3",{attrs:{id:"请求"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#请求"}},[e._v("#")]),e._v(" 请求")]),e._v(" "),_("p",[_("code",[e._v("PUT /<index>/_block/<block>")])]),e._v(" "),_("h3",{attrs:{id:"路径参数"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#路径参数"}},[e._v("#")]),e._v(" 路径参数")]),e._v(" "),_("ul",[_("li",[_("code",[e._v("<index>")])])]),e._v(" "),_("p",[e._v("（可选，字符串）逗号分隔的列表或通配符表达式的索引名称，用于限定请求。")]),e._v(" "),_("p",[e._v("为所有索引添加块，使用 "),_("code",[e._v("_all")]),e._v(" 或 "),_("code",[e._v("*")]),e._v("。为了禁止通过 "),_("code",[e._v("_all")]),e._v(" 或通配符表达式添加块，修改集群设置 "),_("code",[e._v("action.destructive_requires_name")]),e._v(" 为 "),_("code",[e._v("true")]),e._v("。你可以在文件 "),_("code",[e._v("elasticsearch.yml")]),e._v(" 中修改设置，或者通过"),_("a",{attrs:{href:"/rest_apis/cluster_apis/cluster_update_settings"}},[e._v("集群更新设置")]),e._v(" API。")]),e._v(" "),_("ul",[_("li",[_("code",[e._v("<block>")])])]),e._v(" "),_("p",[e._v("（必需，字符串）添加给索引的块类型。")]),e._v(" "),_("p",[e._v("有效值：")]),e._v(" "),_("ol",[_("li",[_("code",[e._v("metadata")]),e._v("\n禁用元数据变更，比如关闭索引。")]),e._v(" "),_("li",[_("code",[e._v("read")]),e._v("\n禁用读操作。")]),e._v(" "),_("li",[_("code",[e._v("read_only")]),e._v("\n禁用写操作和元数据变更。")]),e._v(" "),_("li",[_("code",[e._v("write")]),e._v("\n禁用写操作。然后，允许元数据变更。")])]),e._v(" "),_("h3",{attrs:{id:"查询参数"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#查询参数"}},[e._v("#")]),e._v(" 查询参数")]),e._v(" "),_("ul",[_("li",[_("code",[e._v("allow_no_indices")])])]),e._v(" "),_("p",[e._v("（可选，布尔值）如果为 "),_("code",[e._v("false")]),e._v("，任何通配符、"),_("a",{attrs:{href:"/rest_apis/index_apis/bulk_index_alias"}},[e._v("索引别名")]),e._v("或 "),_("code",[e._v("_all")]),e._v(" 值只针对丢失或关闭的索引，请求将返回一个错误。即使请求以其他开启索引为目标，此行为也适用。例如，如果一个索引以 "),_("code",[e._v("foo")]),e._v(" 开头，而没有索引以 "),_("code",[e._v("bar")]),e._v(" 开头，则以 "),_("code",[e._v("foo*,bar*")]),e._v(" 为目标的请求将返回错误。")]),e._v(" "),_("p",[e._v("默认为 "),_("code",[e._v("true")]),e._v("。")]),e._v(" "),_("ul",[_("li",[_("code",[e._v("expand_wildcards")])])]),e._v(" "),_("p",[e._v("（可选，字符串）通配符表达式可以匹配的索引类型。如果请求可以数据流为目标，则此参数确定通配符表达式是否匹配隐藏的数据流。支持逗号分隔的值，如 "),_("code",[e._v("open,hidden")]),e._v("。有效的值有：")]),e._v(" "),_("ol",[_("li",[_("code",[e._v("all")]),e._v("\n匹配任何数据流或索引，包括 "),_("a",{attrs:{href:"/rest_apis/api_convention/multi_target_syntax#%E9%9A%90%E8%97%8F%E6%95%B0%E6%8D%AE%E6%B5%81%E5%92%8C%E7%B4%A2%E5%BC%95"}},[e._v("hidden")]),e._v("（隐藏的）。")]),e._v(" "),_("li",[_("code",[e._v("open")]),e._v("\n匹配 open（开启）、非隐藏的索引。也匹配任何非隐藏的数据流。")]),e._v(" "),_("li",[_("code",[e._v("closed")]),e._v("\n匹配 closed（关闭）、非隐藏的索引。也匹配任何非隐藏的数据流。数据流不能关闭。")]),e._v(" "),_("li",[_("code",[e._v("hidden")]),e._v("\n匹配隐藏数据流和隐藏索引。必须与 "),_("code",[e._v("open")]),e._v("、"),_("code",[e._v("closed")]),e._v(" 或一起使用。")]),e._v(" "),_("li",[_("code",[e._v("none")]),e._v("\n不接受通配符表达式。")])]),e._v(" "),_("p",[e._v("默认为 "),_("code",[e._v("open")]),e._v("。")]),e._v(" "),_("ul",[_("li",[_("code",[e._v("ignore_unavailable")])])]),e._v(" "),_("p",[e._v("（可选，布尔值）如果为 "),_("code",[e._v("true")]),e._v("，丢失的或关闭的索引不包含在响应中。默认为 "),_("code",[e._v("false")]),e._v("。")]),e._v(" "),_("ul",[_("li",[_("code",[e._v("master_timeout")])])]),e._v(" "),_("p",[e._v("（可选，"),_("RouterLink",{attrs:{to:"/rest_apis/api_convention/common_options.html#时间单位"}},[e._v("时间单位")]),e._v("）等待连接到主节点的时间。如果在超时过期前没有收到响应，则请求失败并返回错误。默认为 "),_("code",[e._v("30s")]),e._v("。")],1),e._v(" "),_("ul",[_("li",[_("code",[e._v("timeout")])])]),e._v(" "),_("p",[e._v("（可选，"),_("RouterLink",{attrs:{to:"/rest_apis/api_convention/common_options.html#时间单位"}},[e._v("时间单位")]),e._v("）等待响应的时间。如果在超时过期之前没有收到响应，则请求失败并返回错误。默认为 "),_("code",[e._v("30s")]),e._v("。")],1),e._v(" "),_("h2",{attrs:{id:"例子"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#例子"}},[e._v("#")]),e._v(" 例子")]),e._v(" "),_("p",[e._v("以下例子展示如何添加一个索引块：")]),e._v(" "),_("div",{staticClass:"language-bash line-numbers-mode"},[_("pre",{pre:!0,attrs:{class:"language-bash"}},[_("code",[e._v("PUT /my-index-000001/_block/write\n")])]),e._v(" "),_("div",{staticClass:"line-numbers-wrapper"},[_("span",{staticClass:"line-number"},[e._v("1")]),_("br")])]),_("p",[e._v("API 返回以下响应：")]),e._v(" "),_("div",{staticClass:"language-json line-numbers-mode"},[_("pre",{pre:!0,attrs:{class:"language-json"}},[_("code",[_("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),_("span",{pre:!0,attrs:{class:"token property"}},[e._v('"acknowledged"')]),e._v(" "),_("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),_("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),_("span",{pre:!0,attrs:{class:"token property"}},[e._v('"shards_acknowledged"')]),e._v(" "),_("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),_("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),_("span",{pre:!0,attrs:{class:"token property"}},[e._v('"indices"')]),e._v(" "),_("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),_("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v(" "),_("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),_("span",{pre:!0,attrs:{class:"token property"}},[e._v('"name"')]),e._v(" "),_("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),_("span",{pre:!0,attrs:{class:"token string"}},[e._v('"my-index-000001"')]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),_("span",{pre:!0,attrs:{class:"token property"}},[e._v('"blocked"')]),e._v(" "),_("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),_("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),e._v("\n  "),_("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" "),_("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])]),e._v(" "),_("div",{staticClass:"line-numbers-wrapper"},[_("span",{staticClass:"line-number"},[e._v("1")]),_("br"),_("span",{staticClass:"line-number"},[e._v("2")]),_("br"),_("span",{staticClass:"line-number"},[e._v("3")]),_("br"),_("span",{staticClass:"line-number"},[e._v("4")]),_("br"),_("span",{staticClass:"line-number"},[e._v("5")]),_("br"),_("span",{staticClass:"line-number"},[e._v("6")]),_("br"),_("span",{staticClass:"line-number"},[e._v("7")]),_("br"),_("span",{staticClass:"line-number"},[e._v("8")]),_("br")])]),_("blockquote",[_("p",[_("a",{attrs:{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/index-modules-blocks.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("原文链接"),_("OutboundLink")],1)])])])}),[],!1,null,null,null);_.default=t.exports}}]);