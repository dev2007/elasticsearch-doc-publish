(window.webpackJsonp=window.webpackJsonp||[]).push([[133],{411:function(t,s,a){"use strict";a.r(s);var e=a(13),r=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"使用-debian-包安装-elasticsearch"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-debian-包安装-elasticsearch"}},[t._v("#")]),t._v(" 使用 Debian 包安装 Elasticsearch")]),t._v(" "),s("p",[t._v("Elasticsearch 的 Debian 包可以"),s("a",{attrs:{href:"/set_up_elasticsearch/installing_elasticsearch/debian#%E6%89%8B%E5%B7%A5%E4%B8%8B%E8%BD%BD%E5%92%8C%E5%AE%89%E8%A3%85-Debian-%E5%8C%85"}},[t._v("从我们的网站")]),t._v("或者从"),s("a",{attrs:{href:"/set_up_elasticsearch/installing_elasticsearch/debian#%E4%BB%8E-APT-%E4%BB%93%E5%BA%93%E5%AE%89%E8%A3%85"}},[t._v("我们的 APT 仓库")]),t._v("下载。它可以用于在任何基于 Debian 的系统（如 Debian 和 Ubuntu）上安装 Elasticsearch。")]),t._v(" "),s("p",[t._v("这个包包含免费和订阅的特性。"),s("a",{attrs:{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/license-settings.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("开始 30 天的试用"),s("OutboundLink")],1),t._v("，尝试所有功能。")]),t._v(" "),s("p",[t._v("Elasticsearch 的最新稳定版本，能在 "),s("a",{attrs:{href:"https://www.elastic.co/downloads/elasticsearch",target:"_blank",rel:"noopener noreferrer"}},[t._v("Elasticsearch 下载页面"),s("OutboundLink")],1),t._v("找到。其他版本能在"),s("a",{attrs:{href:"https://www.elastic.co/downloads/past-releases",target:"_blank",rel:"noopener noreferrer"}},[t._v("历史发布页面"),s("OutboundLink")],1),t._v("找到。")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),s("p",[t._v("Elasticsearch 包含 JDK 维护者（GPLv2+CE）提供的 "),s("a",{attrs:{href:"https://openjdk.java.net/",target:"_blank",rel:"noopener noreferrer"}},[t._v("OpenJDK"),s("OutboundLink")],1),t._v(" 捆绑版本。要使用自己的 Java 版本，查阅 "),s("a",{attrs:{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/setup.html#jvm-version",target:"_blank",rel:"noopener noreferrer"}},[t._v("JVM 版本要求"),s("OutboundLink")],1),t._v("。")])]),t._v(" "),s("h2",{attrs:{id:"导入-elasticsearch-pgp-密钥"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#导入-elasticsearch-pgp-密钥"}},[t._v("#")]),t._v(" 导入 Elasticsearch PGP 密钥")]),t._v(" "),s("p",[t._v("我们使用带指纹的 Elasticsearch 签名密钥（PGP 密钥 "),s("a",{attrs:{href:"https://pgp.mit.edu/pks/lookup?op=vindex&search=0xD27D666CD88E42B4",target:"_blank",rel:"noopener noreferrer"}},[t._v("D88E42B4"),s("OutboundLink")],1),t._v("，存在"),s("a",{attrs:{href:"https://pgp.mit.edu",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://pgp.mit.edu"),s("OutboundLink")],1),t._v("上）签名所有的包：")]),t._v(" "),s("p",[s("code",[t._v("4609 5ACC 8548 582C 1A26 99A9 D27D 666C D88E 42B4")])]),t._v(" "),s("p",[t._v("下载和安装公共签名密钥：")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-qO")]),t._v(" - https://artifacts.elastic.co/GPG-KEY-elasticsearch "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" apt-key "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" -\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("h2",{attrs:{id:"从-apt-仓库安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#从-apt-仓库安装"}},[t._v("#")]),t._v(" 从 APT 仓库安装")]),t._v(" "),s("p",[t._v("在继续之前，你可能需要在 Debian 上安装 "),s("code",[t._v("apt-transport-https")]),t._v("包：")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" apt-transport-https\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("将仓库定义保存到 "),s("code",[t._v("/etc/apt/sources.list.d/elastic-7.x.list")]),t._v(":")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"deb https://artifacts.elastic.co/packages/7.x/apt stable main"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tee")]),t._v(" /etc/apt/sources.list.d/elastic-7.x.list\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("blockquote",[s("p",[t._v("由于以下原因，指南不使用 "),s("code",[t._v("add-apt-repository")]),t._v(":")]),t._v(" "),s("ol",[s("li",[s("code",[t._v("add-apt-repository")]),t._v(" 向系统 "),s("code",[t._v("/etc/apt/sources.list")]),t._v(" 文件中添加条目，而不是 "),s("code",[t._v("/etc/apt/sources.list.d")]),t._v(" 中的每个仓库的干净文件")]),t._v(" "),s("li",[s("code",[t._v("add-apt-repository")]),t._v(" 不是许多发行版本的默认安装部分，需要许多非默认的依赖")]),t._v(" "),s("li",[t._v("老版本的 "),s("code",[t._v("add-apt-repository")]),t._v(" 总会添加一个 "),s("code",[t._v("deb-src")]),t._v(" 条目，由于我们没有提供源包，这会导致错误。如果你已经添加了 "),s("code",[t._v("deb-src")]),t._v(" 条目，在你删除 "),s("code",[t._v("deb-src")]),t._v(" 条目前，你会看到如下错误："),s("br"),t._v(" "),s("code",[t._v("Unable to find expected entry 'main/source/Sources' in Release file (Wrong sources.list entry or malformed file)")])])])]),t._v(" "),s("p",[t._v("你可以这样安装 Elasticsearch Debian 包：")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" elasticsearch\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("div",{staticClass:"custom-block danger"},[s("p",{staticClass:"custom-block-title"},[t._v("警告")]),t._v(" "),s("p",[t._v("如果 Elasticsearch 仓库中存在两条相同的条目，你在 "),s("code",[t._v("apt-get update")]),t._v(" 操作时，会看到如下错误："),s("br"),t._v(" "),s("code",[t._v("Duplicate sources.list entry https://artifacts.elastic.co/packages/7.x/apt/ ...")]),s("br"),t._v("\n检查 "),s("code",[t._v("/etc/apt/sources.list.d/elasticsearch-7.x.list")]),t._v(" 的重复条目，或者在 "),s("code",[t._v("/etc/apt/sources.list.d/")]),t._v(" 中的文件和 "),s("code",[t._v("/etc/apt/sources.list")]),t._v(" 文件中定位重复条目。")])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),s("p",[t._v("在基于 systemd 的发行版上，安装脚本尝试设置内核参数（如，"),s("code",[t._v("vm.max_map_count")]),t._v("）；你可以通过屏蔽 systemd-sysctl.service 单位来跳过这个操作。")])]),t._v(" "),s("h2",{attrs:{id:"手工下载和安装-debian-包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#手工下载和安装-debian-包"}},[t._v("#")]),t._v(" 手工下载和安装 Debian 包")]),t._v(" "),s("p",[t._v("Elasticsearch v7.11.1 的 Debian 包，可以按以下命令从网站下载和安装：")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.11.1-amd64.deb\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.11.1-amd64.deb.sha512\nshasum "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("512")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" elasticsearch-7.11.1-amd64.deb.sha512\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" dpkg "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-i")]),t._v(" elasticsearch-7.11.1-amd64.deb\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("ul",[s("li",[s("code",[t._v("shasum -a 512 -c")]),t._v(" 比较下载的 Debian 包 SHA 值和公开的校验值。正常应该输出 "),s("code",[t._v("elasticsearch-{version}-amd64.deb: OK")]),t._v("。")])]),t._v(" "),s("h2",{attrs:{id:"启用系统索引自动创建-x-pack"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启用系统索引自动创建-x-pack"}},[t._v("#")]),t._v(" 启用系统索引自动创建 ["),s("code",[t._v("X-Pack")]),t._v("]")]),t._v(" "),s("p",[t._v("一些商业特性会在 Elasticsearch 中自动创建索引。默认情况下， Elasticsearch 配置为允许自动创建索引而不需要额外的步骤。然而，如果你在 Elasticsearch 中禁用了自动索引创建，则必须在 "),s("code",[t._v("elasticsearch.yml")]),t._v(" 中配置 "),s("a",{attrs:{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-index_.html#index-creation",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("action.auto_create_index")]),s("OutboundLink")],1),t._v(" 以允许商业特性创建以下索引：")]),t._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("action.auto_create_index")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" .monitoring*"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(".watches"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(".triggered_watches"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(".watcher"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("history*"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(".ml*\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("div",{staticClass:"custom-block danger"},[s("p",{staticClass:"custom-block-title"},[t._v("警告")]),t._v(" "),s("p",[t._v("如果你在使用 "),s("a",{attrs:{href:"https://www.elastic.co/products/logstash",target:"_blank",rel:"noopener noreferrer"}},[t._v("Logstash"),s("OutboundLink")],1),t._v(" 或 "),s("a",{attrs:{href:"https://www.elastic.co/products/beats",target:"_blank",rel:"noopener noreferrer"}},[t._v("Beats"),s("OutboundLink")],1),t._v("，那么你很可能需要在你的 "),s("code",[t._v("action.auto_create_index")]),t._v(" 设置中使用额外的索引名字，具体的值取决于你的本地配置。如果你不确定你环境的正确值，可以考虑设置这个值为*以允许自动创建所有索引。")])]),t._v(" "),s("h2",{attrs:{id:"sysv-init-对-systemd"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sysv-init-对-systemd"}},[t._v("#")]),t._v(" SysV "),s("code",[t._v("init")]),t._v(" 对 "),s("code",[t._v("systemd")])]),t._v(" "),s("p",[t._v("Elasticsearch 在安装后不会自动启动。如何启动和停止 Elasticsearch，取决于你的系统用的 SysV "),s("code",[t._v("init")]),t._v(" 还是 "),s("code",[t._v("systemd")]),t._v("（更新的发行版用的）。你可以通过以下命令来判断用的哪个：")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("h2",{attrs:{id:"使用-sysv-init-运行-elasticsearch"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-sysv-init-运行-elasticsearch"}},[t._v("#")]),t._v(" 使用 SysV "),s("code",[t._v("init")]),t._v(" 运行 Elasticsearch")]),t._v(" "),s("p",[t._v("使用 "),s("code",[t._v("update-rc.d")]),t._v(" 命令配置当系统启动时自动启动 Elasticsearch：")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" update-rc.d elasticsearch defaults "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("95")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("Elasticsearch 可以使用 "),s("code",[t._v("service")]),t._v(" 命令来启动和停止：")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-i")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" elasticsearch start\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-i")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" elasticsearch stop\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),s("p",[t._v("如果 Elasticsearch 由于任何原因启动失败，它会输出失败原因到标准输出（STDOUT）。日志文件可以在 "),s("code",[t._v("/var/log/elasticsearch/")]),t._v(" 中被找到。")]),t._v(" "),s("h2",{attrs:{id:"使用-systemd-运行-elasticsearch"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-systemd-运行-elasticsearch"}},[t._v("#")]),t._v(" 使用 "),s("code",[t._v("systemd")]),t._v(" 运行 Elasticsearch")]),t._v(" "),s("p",[t._v("为了配置 Elasticsearch 在系统启动时自动启动，运行以下命令：")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" /bin/systemctl daemon-reload\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" /bin/systemctl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("enable")]),t._v(" elasticsearch.service\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),s("p",[t._v("Elasticsearch 可以按以下方式启动和停止：")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" systemctl start elasticsearch.service\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" systemctl stop elasticsearch.service\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),s("p",[t._v("这些命令不提供 Elasticsearch 运行成功与否的反馈。相反，信息写在位于 "),s("code",[t._v("/var/log/elasticsearch/")]),t._v(" 中的日志文件。")]),t._v(" "),s("p",[t._v("如果你的 Elasticsearch 密码库受密码保护，你需要使用本地文件和 "),s("code",[t._v("systemd")]),t._v(" 环境变量向密码库提供密码。本地文件存在时，应该受到保护，一旦 Elasticsearch 启动并运行，就可以安全删除此文件。")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"keystore_password"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /path/to/my_pwd_file.tmp\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("600")]),t._v(" /path/to/my_pwd_file.tmp\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" systemctl set-environment "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ES_KEYSTORE_PASSPHRASE_FILE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/path/to/my_pwd_file.tmp\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" systemctl start elasticsearch.service\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("p",[t._v("默认情况下，Elasticsearch 服务不会在 "),s("code",[t._v("systemd")]),t._v(" 日志中记录信息。要启用 "),s("code",[t._v("journalctl")]),t._v(" 日志，必须从文件 "),s("code",[t._v("elasticsearch.service")]),t._v(" 中的 "),s("code",[t._v("ExecStart")]),t._v(" 命令行移除 "),s("code",[t._v("--quiet")]),t._v(" 选项。")]),t._v(" "),s("p",[t._v("当 "),s("code",[t._v("systemd")]),t._v(" 日志启用时，使用 "),s("code",[t._v("journalctl")]),t._v(" 命令日志信息可用。")]),t._v(" "),s("p",[t._v("要跟踪日志：")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" journalctl "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("列出 Elasticsearch 服务的日志条目：")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" journalctl "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--unit")]),t._v(" elasticsearch\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("要列出从给定时间开始的 Elasticsearch 服务的日志条目，请执行以下操作：")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" journalctl "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--unit")]),t._v(" elasticsearch "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--since")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2016-10-30 18:17:16"')]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("检查 "),s("code",[t._v("man journalctl")]),t._v(" 或者 "),s("a",{attrs:{href:"https://www.freedesktop.org/software/systemd/man/journalctl.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.freedesktop.org/software/systemd/man/journalctl.html"),s("OutboundLink")],1),t._v(" 获取更多的命令行选项。")]),t._v(" "),s("h2",{attrs:{id:"检查-elasticsearch-是否正在运行"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#检查-elasticsearch-是否正在运行"}},[t._v("#")]),t._v(" 检查 Elasticsearch 是否正在运行")]),t._v(" "),s("p",[t._v("你可以通过向 "),s("code",[t._v("localhost")]),t._v(" 的 "),s("code",[t._v("9200")]),t._v(" 端口发送 HTTP 请求来测试 Elasticsearch 节点是否正在运行：")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("GET /\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("这会给你这样的响应：")]),t._v(" "),s("div",{staticClass:"language-json line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"name"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Cp8oag6"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"cluster_name"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"elasticsearch"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"cluster_uuid"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AT69_T_DTp-1qgIJlatQqA"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"version"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"number"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"7.11.1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"build_flavor"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"build_type"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tar"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"build_hash"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"f27399d"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"build_date"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2016-03-30T09:51:41.449Z"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"build_snapshot"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"lucene_version"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"8.7.0"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"minimum_wire_compatibility_version"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.2.3"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"minimum_index_compatibility_version"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.2.3"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"tagline"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"You Know, for Search"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br")])]),s("h2",{attrs:{id:"配置-elasticsearch"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置-elasticsearch"}},[t._v("#")]),t._v(" 配置 Elasticsearch")]),t._v(" "),s("p",[s("code",[t._v("/etc/elasticsearch")]),t._v(" 目录包含 Elasticsearch 默认运行时配置。该目录和所包含的所有文件所有权在包安装时设置为 "),s("code",[t._v("root:elasticsearch")]),t._v("。")]),t._v(" "),s("p",[s("code",[t._v("setgid")]),t._v(" 标志对目录 "),s("code",[t._v("/etc/elasticsearch")]),t._v(" 应用组权限，以确保 Elasticsearch 能读取任何包含的文件和子目录。所有文件和子目录继承 "),s("code",[t._v("root:elasticsearch")]),t._v(" 所有权。从该目录或者任何子目录运行命令，如 "),s("a",{attrs:{href:"/set_up_elasticsearch/configuring_elasticsearch/secure"}},[t._v("elasticsearch-keystore 工具")]),t._v("，需要 "),s("code",[t._v("root:elasticsearch")]),t._v(" 权限。")]),t._v(" "),s("p",[t._v("Elasticsearch 默认从 "),s("code",[t._v("/etc/elasticsearch/elasticsearch.yml")]),t._v(" 文件加载它的配置。在"),s("a",{attrs:{href:"/set_up_elasticsearch/config"}},[t._v("配置 Elasticsearch")]),t._v(" 中解释了配置文件的格式。")]),t._v(" "),s("p",[t._v("Debian 包也有一个系统配置文件（"),s("code",[t._v("/etc/default/elasticsearch")]),t._v("），它允许你设置以下的变量：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}}),t._v(" "),s("th",{staticStyle:{"text-align":"left"}})])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("JAVA_HOME")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("设置使用的自定义 Java 路径")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("MAX_OPEN_FILES")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("打开文件的最大值，默认为 "),s("code",[t._v("65535")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("MAX_LOCKED_MEMORY")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("最大锁定内存值。如果你在 elasticsearch.yml 中使用 "),s("code",[t._v("bootstrap.memory_lock")]),t._v(" 选项，设置为 "),s("code",[t._v("unlimited")]),t._v("。")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("MAX_MAP_COUNT")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("进程可能具有的最大内存映射区域数。如果你使用 "),s("code",[t._v("mmapfs")]),t._v(" 作为索引存储类型，请确保将其设置一个高值。有关更多的信息，请查看关于 "),s("code",[t._v("max_map_count")]),t._v(" 的 "),s("a",{attrs:{href:"https://github.com/torvalds/linux/blob/master/Documentation/sysctl/vm.txt",target:"_blank",rel:"noopener noreferrer"}},[t._v("linux 内核文档"),s("OutboundLink")],1),t._v("。在 Elasticsearch 启动前，通过 "),s("code",[t._v("sysctl")]),t._v(" 设置，默认为 "),s("code",[t._v("262144")]),t._v("。")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("ES_PATH_CONF")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("配置文件目录（需要包含 "),s("code",[t._v("elasticsearch.yml")]),t._v("、"),s("code",[t._v("jvm.options")]),t._v(" 和 "),s("code",[t._v("log4j2.properties")]),t._v(" 文件），默认为 "),s("code",[t._v("/etc/elasticsearch")]),t._v("。")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("ES_JAVA_OPTS")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("你想应用的任何其他 JVM 系统属性。")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("RESTART_ON_UPGRADE")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("在包升级时配置重启，默认为 "),s("code",[t._v("false")]),t._v("。这意味着你必须在手工安装包后重启你的 Elasticseach 实例。这样做的原因是为了确保集群的升级不会导致持续的分片重分配，进而导致的高网络流量和降低了集群的响应时间。")])])])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),s("p",[t._v("使用 "),s("code",[t._v("systemd")]),t._v(" 的发行版本要求需要通过 "),s("code",[t._v("systemd")]),t._v(" 配置系统资源限制，而不是通过 "),s("code",[t._v("/etc/sysconfig/elasticsearch")]),t._v(" 文件。更多信息，请参阅 "),s("a",{attrs:{href:"/set_up_elasticsearch/important_system_config/system#Systemd-%E9%85%8D%E7%BD%AE"}},[t._v("Systemd 配置")]),t._v("。")])]),t._v(" "),s("h2",{attrs:{id:"debian-包目录结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#debian-包目录结构"}},[t._v("#")]),t._v(" Debian 包目录结构")]),t._v(" "),s("p",[t._v("Debian 包将配置文件、日志和数据目录放在基于 Debian 系统的适当位置：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[t._v("类型")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("描述")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("默认位置")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("设置")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("home")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("Elasticsearch 主目录或 "),s("code",[t._v("$ES_HOME")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("/usr/share/elasticsearch")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("bin")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("二进制脚本，包括启动节点的 "),s("code",[t._v("elasticsearch")]),t._v(" 和安装插件的 "),s("code",[t._v("elasticsearch-plugin")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("/usr/share/elasticsearch/bin")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("conf")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("配置文件，包括 "),s("code",[t._v("elasticsearch.yml")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("/etc/elasticsearch")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"/set_up_elasticsearch/config#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BD%8D%E7%BD%AE"}},[t._v("ES_PATH_CONF")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("conf")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("环境变量，包括堆大小，文件描述符。")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("/etc/default/elasticsearch")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("data")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("分配在节点上的每个索引和分片的数据文件位置。可以有多个位置。")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("/var/lib/elasticsearch")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("path.data")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("jdk")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("用于运行 Elasticsearch 的捆绑 Java 开发工具包。可以通过在 "),s("code",[t._v("/etc/default/elasticsearch")]),t._v(" 中覆盖 "),s("code",[t._v("JAVA_HOME")]),t._v("环境变量。")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("/usr/share/elasticsearch/jdk")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("logs")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("日志文件位置")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("/var/log/elasticsearch")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("path.logs")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("plugins")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("插件文件位置。每个插件会包含在一个子目录中。")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("/usr/share/elasticsearch/plugins")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("repo")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("共享文件系统仓库位置。可以有多个位置。文件系统仓库可以放在此处指定的任何目录的任何子目录中。")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("未配置")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("path.repo")])])])])]),t._v(" "),s("h2",{attrs:{id:"下一步"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#下一步"}},[t._v("#")]),t._v(" 下一步")]),t._v(" "),s("p",[t._v("你现在有一个测试 Elasticsearch 环境部署好。在你使用 Elasticsearch 正式开始开发或者生产之前，你必须做一些额外的设置：")]),t._v(" "),s("ul",[s("li",[t._v("学习如何配置 "),s("a",{attrs:{href:"/set_up_elasticsearch/config"}},[t._v("Elasticsearch")]),t._v("。")]),t._v(" "),s("li",[t._v("配置"),s("a",{attrs:{href:"/set_up_elasticsearch/important_es_config"}},[t._v("重要的 Elasticsearch 设置")]),t._v("。")]),t._v(" "),s("li",[t._v("配置"),s("a",{attrs:{href:"/set_up_elasticsearch/important_system_config"}},[t._v("重要的系统设置")]),t._v("。")])]),t._v(" "),s("blockquote",[s("p",[s("a",{attrs:{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/deb.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("原文链接"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=r.exports}}]);