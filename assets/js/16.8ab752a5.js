(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{296:function(_,e,v){"use strict";v.r(e);var i=v(13),a=Object(i.a)({},(function(){var _=this,e=_._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[e("h1",{attrs:{id:"索引模块"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#索引模块"}},[_._v("#")]),_._v(" 索引模块")]),_._v(" "),e("p",[_._v("索引模块是按索引创建的模块，控制有关索引的所有方面。")]),_._v(" "),e("InArticleAdsense",{attrs:{"data-ad-client":"ca-pub-8380975615223941","data-ad-slot":"9428292757"}}),_._v(" "),e("h2",{attrs:{id:"索引设置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#索引设置"}},[_._v("#")]),_._v(" 索引设置")]),_._v(" "),e("p",[_._v("可以为每个索引设置索引级的设置。设置如下：")]),_._v(" "),e("ul",[e("li",[_._v("静态设置")])]),_._v(" "),e("p",[_._v("只能在索引创建时，或者"),e("a",{attrs:{href:"/rest_apis/index_apis/open_index"}},[_._v("关闭的索引")]),_._v("上设置。")]),_._v(" "),e("ul",[e("li",[_._v("动态设置")])]),_._v(" "),e("p",[_._v("可以通过"),e("a",{attrs:{href:"/rest_apis/index_apis/update_index_settings"}},[_._v("更新索引 API")]),_._v(" 在活动的索引上修改。")]),_._v(" "),e("div",{staticClass:"custom-block danger"},[e("p",{staticClass:"custom-block-title"},[_._v("警告")]),_._v(" "),e("p",[_._v("在关闭的索引上修改静态或动态索引设置，可能会导致不正确的设置。如果不删除并重建索引，是无法修正这些设置。")])]),_._v(" "),e("h2",{attrs:{id:"静态索引设置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#静态索引设置"}},[_._v("#")]),_._v(" 静态索引设置")]),_._v(" "),e("p",[_._v("以下是与特定索引模块无关的静态索引设置的列表：")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("index.number_of_shards")])])]),_._v(" "),e("p",[_._v("索引应该具有的主分片数量。默认为 "),e("code",[_._v("1")]),_._v("。此设置只能在创建索引时设置。在关闭的索引上也不能修改。")]),_._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[_._v("提示")]),_._v(" "),e("p",[_._v("每个分片数量限定为 "),e("code",[_._v("1,024")]),_._v("。这是一个安全限定，以防止意外创建索引，而这些索引会由于资源分配而破坏集群的稳定性。这个限定可以通过指定 "),e("code",[_._v('export ES_JAVA_OPTS="-Des.index.max_number_of_shards=128"')]),_._v(" 系统属性来修改，这个属性属于集群的每个节点。")])]),_._v(" "),e("ul",[e("li",[e("code",[_._v("index.number_of_routing_shards")])])]),_._v(" "),e("p",[_._v("用于"),e("a",{attrs:{href:"/rest_apis/index_apis/split_api"}},[_._v("拆分")]),_._v("索引的路由分片数。\n例如，"),e("code",[_._v("number_of_routing_shards")]),_._v(" 设置为 "),e("code",[_._v("30")]),_._v("（"),e("code",[_._v("5 x 3 x 2")]),_._v("）的 5 分片索引，可以除以因子 "),e("code",[_._v("2")]),_._v(" 或 "),e("code",[_._v("3")]),_._v("。换言之，可以按以下方式拆分：")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("5")]),_._v(" → "),e("code",[_._v("10")]),_._v(" → "),e("code",[_._v("30")]),_._v(" (除以 2, 再除以 3)")]),_._v(" "),e("li",[e("code",[_._v("5")]),_._v(" → "),e("code",[_._v("15")]),_._v(" → "),e("code",[_._v("30")]),_._v(" (除以 3, 再除以 2)")]),_._v(" "),e("li",[e("code",[_._v("5")]),_._v(" → "),e("code",[_._v("30")]),_._v(" (除以 6)")])]),_._v(" "),e("p",[_._v("这个设置的默认值基于索引的主分片数。默认情况下，允许按 2 的因子拆分最多 1,024 个分片。")]),_._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[_._v("提示")]),_._v(" "),e("p",[_._v("在 Elasticsearch 7.0.0 以及更新的版本，这个设置影响文档在分片中的分布方式。使用自定义路由重新索引旧索引时，你必须显式设置 "),e("code",[_._v("index.number_of_routing_shards")]),_._v(" 以维持相同的文档分布。参阅"),e("a",{attrs:{href:"https://www.elastic.co/guide/en/elasticsearch/reference/7.0/breaking-changes-7.0.html#_document_distribution_changes",target:"_blank",rel:"noopener noreferrer"}},[_._v("相关的碎裂变化"),e("OutboundLink")],1),_._v("。")])]),_._v(" "),e("ul",[e("li",[e("code",[_._v("index.shard.check_on_startup")])])]),_._v(" "),e("p",[_._v("在打开之前是否应该检查分片是否损坏。当检测到损坏时，它将阻止打开分片，允许的值：")]),_._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[_._v("- `false`\n（默认值）当打开分片时不检测损坏。\n- `checksum`\n检测物理损坏。\n- `true`\n检测物理和逻辑损坏。这会消耗更高的 CPU 和内存。\n")])])]),e("div",{staticClass:"custom-block danger"},[e("p",{staticClass:"custom-block-title"},[_._v("警告")]),_._v(" "),e("p",[_._v("仅限专家。在大型索引上检查分片可能花费更多的时间。")])]),_._v(" "),e("ul",[e("li",[e("p",[e("code",[_._v("index.codec")]),_._v(" "),e("code",[_._v("default")]),_._v(" 值使用 LZ4 压缩来压缩存储的数据，但可以设置为 "),e("code",[_._v("best_compression")]),_._v(",即使用 "),e("a",{attrs:{href:"https://en.wikipedia.org/wiki/DEFLATE",target:"_blank",rel:"noopener noreferrer"}},[_._v("DEFLATE"),e("OutboundLink")],1),_._v(" 来获得更高的压缩比，但会降低存储字段的性能。如果要更新压缩类型，合并段后将应用新的压缩类型。段合并可以使用"),e("a",{attrs:{href:"/rest_apis/index_apis/force_merge"}},[_._v("强制合并")]),_._v("来强制合并。")])]),_._v(" "),e("li",[e("p",[e("code",[_._v("index.routing_partition_size")])])])]),_._v(" "),e("p",[_._v("自定义路由值可以转到的分片数。默认为 1，只能在索引创建时设置。此值必须小于 "),e("code",[_._v("index.number_of_shards")]),_._v("，除非 "),e("code",[_._v("index.number_of_shards")]),_._v(" 值也是 1。参阅"),e("a",{attrs:{href:"/mapping/metadata/_routing#%E8%B7%AF%E7%94%B1%E5%88%B0%E7%B4%A2%E5%BC%95%E5%88%86%E5%8C%BA"}},[_._v("路由到索引分区")]),_._v("，获取如何使用此设置的更多信息。")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("index.soft_deletes.enabled")])])]),_._v(" "),e("p",[_._v("标示索引是否允许软删除。软删除只能在索引创建时设置，也只能配置在 Elasticsearch 6.5.0 及后续版本创建的索引上。默认为 "),e("code",[_._v("true")]),_._v("。（7.6.0版本就不推荐，不推荐禁用软删除创建索引，并在未来版本移除此设置）")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("index.soft_deletes.retention_lease.period")])])]),_._v(" "),e("p",[_._v("分片历史保持租约在它被认为过期前的最大周期。分片历史保留租约，确保在 Lucene 索引上进行合并时保留软删除。如果软删除在可以复制到跟随者之前被合并，由于领导者的历史记录不完整，后续过程将失败。默认为 "),e("code",[_._v("12h")]),_._v("。")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("index.load_fixed_bitset_filters_eagerly")])])]),_._v(" "),e("p",[_._v("标示是否为嵌套查询预加载"),e("a",{attrs:{href:"/query_dsl/query"}},[_._v("缓存过滤器")]),_._v("。可能值为 "),e("code",[_._v("true")]),_._v("（默认值）和 "),e("code",[_._v("false")]),_._v("。")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("index.hidden")])])]),_._v(" "),e("p",[_._v("标示默认情况下，索引是否应该隐藏。当使用通配符表达式时，隐藏索引默认不会返回。通过 "),e("code",[_._v("expand_wildcards")]),_._v(" 参数，每个请求都可以控制此行为。可能的值为 "),e("code",[_._v("true")]),_._v(" 和 "),e("code",[_._v("false")]),_._v("（默认值）。")]),_._v(" "),e("h2",{attrs:{id:"动态索引设置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#动态索引设置"}},[_._v("#")]),_._v(" 动态索引设置")]),_._v(" "),e("p",[_._v("以下是与任何特定索引模块无关的所有动态设置列表：")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("index.number_of_replicas")])])]),_._v(" "),e("p",[_._v("每个主分片的副本数。默认为 1。")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("index.auto_expand_replicas")])])]),_._v(" "),e("p",[_._v("根据集群中数据节点的数量，自动扩展副本的数量。设置为以连接符分隔的下限和上限（如，"),e("code",[_._v("0-5")]),_._v("）或者使用 "),e("code",[_._v("all")]),_._v(" 作为上限（如，"),e("code",[_._v("0-all")]),_._v("）。默认为 "),e("code",[_._v("false")]),_._v("（即禁用）。请注意自动扩展的副本数量只考虑"),e("a",{attrs:{href:"/index_modules/index_shard/shard_allocation"}},[_._v("分配筛选")]),_._v("规则，而忽略其他分配规则，如"),e("a",{attrs:{href:"/set_up_elasticsearch/configuring_elasticsearch/cluster_level#%E5%88%86%E7%89%87%E5%88%86%E9%85%8D%E6%84%9F%E7%9F%A5"}},[_._v("分片分配感知")]),_._v("和"),e("a",{attrs:{href:"/index_modules/index_shard/total_shards"}},[_._v("每个节点分片总数")]),_._v("，如果适用规则阻止分配所有副本，则这可能导致集群健康变为 "),e("code",[_._v("YELLOW")]),_._v("（黄色）。")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("index.search.idle.after")])])]),_._v(" "),e("p",[_._v("在被认为是搜索空闲之前，分片不能接收搜索或获取请求的时间。（默认值为 "),e("code",[_._v("30s")]),_._v("）")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("index.refresh_interval")])])]),_._v(" "),e("p",[_._v("执行刷新操作的频率，它可以使最近对索引的修改对搜索可见。默认为 "),e("code",[_._v("1s")]),_._v("。可以设置为 "),e("code",[_._v("-1")]),_._v(" 为禁止刷新。如果这个设置未显示设置，则至少在 "),e("code",[_._v("index.search.idle.after")]),_._v(" 秒后，未看到搜索流量的分片在收到搜索请求前不会接收后台刷新。此行为旨在在默认情况下，当不执行搜索时自动优化批量索引。为了选择退出此行为，应将显式值 "),e("code",[_._v("1s")]),_._v(" 设置为刷新间隔。")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("index.max_result_window")])])]),_._v(" "),e("p",[_._v("搜索到此索引的 "),e("code",[_._v("from + size")]),_._v(" 的最大值。默认为 "),e("code",[_._v("10,000")]),_._v("。搜索请求占用的堆内存和时间，与 "),e("code",[_._v("from + size")]),_._v(" 成比例，这也限制了内存。参阅"),e("a",{attrs:{href:"/search/paginate#%E6%BB%9A%E5%8A%A8%E6%90%9C%E7%B4%A2%E7%BB%93%E6%9E%9C"}},[_._v("Scroll")]),_._v("或"),e("a",{attrs:{href:"/search/paginate#search_after"}},[_._v("Search After")]),_._v("，以获得更有效的替换提高这一点。")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("index.max_inner_result_window")])])]),_._v(" "),e("p",[_._v("此索引的内部命中定义和顶级命中聚合的 "),e("code",[_._v("from + size")]),_._v(" 的最大值。默认为 "),e("code",[_._v("100")]),_._v("。内部命中和顶级命中聚合占用的堆内存和时间，与 "),e("code",[_._v("from + size")]),_._v(" 成比例，这也限制了内存。")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("index.max_rescore_window")])])]),_._v(" "),e("p",[_._v("此索引的搜索中 "),e("code",[_._v("rescore")]),_._v(" 请求的 "),e("code",[_._v("window_size")]),_._v(" 最大值。默认为 "),e("code",[_._v("index.max_result_window")]),_._v("的值（默认为 "),e("code",[_._v("10,000")]),_._v("）。搜索请求占用的堆内存和时间与 "),e("code",[_._v("max(window_size, from + size)")]),_._v(" 成比例，这也限制了内存。")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("index.max_docvalue_fields_search")])])]),_._v(" "),e("p",[_._v("查询中允许的 "),e("code",[_._v("docvalue_fields")]),_._v(" 最大值。默认为 "),e("code",[_._v("100")]),_._v("。文档值字段代价高昂，因为它们可能会导致每个文档查找每个字段。")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("index.max_script_fields")])])]),_._v(" "),e("p",[_._v("查询中允许的 "),e("code",[_._v("script_fields")]),_._v(" 最大值。 默认为 "),e("code",[_._v("32")]),_._v("。")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("index.max_ngram_diff")])])]),_._v(" "),e("p",[_._v("NGramTokenizer 和 NGramTokenFilter的 min_gram 和 max_gram 允许差值。默认为 "),e("code",[_._v("1")]),_._v("。")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("index.max_shingle_diff")])])]),_._v(" "),e("p",[e("a",{attrs:{href:"/text_analysis/token/shingle"}},[e("code",[_._v("shingle")]),_._v(" 标记过滤器")]),_._v("在 max_shingle_size 和 min_shingle_size 间允许的最大差异。默认为 "),e("code",[_._v("3")]),_._v("。")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("index.max_refresh_listeners")])])]),_._v(" "),e("p",[_._v("索引的每个分片上可用的刷新监听器的最大值。监听器常实现 "),e("a",{attrs:{href:"/rest_apis/document_apis/refresh"}},[e("code",[_._v("refresh=wait_for")])])]),_._v(" "),e("ul",[e("li",[e("code",[_._v("index.analyze.max_token_count")])])]),_._v(" "),e("p",[_._v("使用 _analyze API 的可以生成的最大标记数。默认为 "),e("code",[_._v("10,000")]),_._v("。")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("index.highlight.max_analyzed_offset")])])]),_._v(" "),e("p",[_._v("用于高亮请求的分析的最大字符数。此设置仅用于对文本的高亮请求——此文本被不带偏移量或词语向量索引。默认为 "),e("code",[_._v("1,000,000")]),_._v("。")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("index.max_terms_count")])])]),_._v(" "),e("p",[_._v("用于词语查询（Terms Query）的词语最大值。默认为 "),e("code",[_._v("65,536")]),_._v("。")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("index.max_regex_length")])])]),_._v(" "),e("p",[_._v("用于正则查询（Regexp Query）的正则最大长度。默认为 "),e("code",[_._v("1,000")]),_._v("。")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("index.query.default_field")])])]),_._v(" "),e("p",[_._v("（字符串或字符串数组）匹配一个或多个字段的通配符（*）模式。默认情况下，以下查询类型搜索这些匹配字段：")]),_._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"/query_dsl/specialized_queries/more_like_this"}},[_._v("更像这样")])]),_._v(" "),e("li",[e("a",{attrs:{href:"/query_dsl/full_text_queries/multi_match"}},[_._v("多重匹配")])]),_._v(" "),e("li",[e("a",{attrs:{href:"/query_dsl/full_text_queries/query_string"}},[_._v("查询字符串")])]),_._v(" "),e("li",[e("a",{attrs:{href:"/query_dsl/full_text_queries/simple_query_string"}},[_._v("简单查询字符串")])])]),_._v(" "),e("p",[_._v("默认为 * ，它匹配所有符合"),e("a",{attrs:{href:"/query_dsl/term_level_queries/term_level_queries"}},[_._v("词语级查询")]),_._v("的字段，不包括元数据字段。")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("index.routing.allocation.enable")])])]),_._v(" "),e("p",[_._v("控制索引的分片分配。可设置为：")]),_._v(" "),e("ul",[e("li",[e("p",[e("code",[_._v("all")]),_._v(" (默认) - 允许所有分片分片分配。")])]),_._v(" "),e("li",[e("p",[e("code",[_._v("primaries")]),_._v(" - 允许主分片分片分配。")])]),_._v(" "),e("li",[e("p",[e("code",[_._v("new_primaries")]),_._v(" - 允许新创建的主分片分片分配。")])]),_._v(" "),e("li",[e("p",[e("code",[_._v("none")]),_._v(" - 不允许分片分配。")])]),_._v(" "),e("li",[e("p",[e("code",[_._v("index.routing.rebalance.enable")])])])]),_._v(" "),e("p",[_._v("允许索引分片重平衡。可设置为：")]),_._v(" "),e("ul",[e("li",[e("p",[e("code",[_._v("all")]),_._v("（默认） - 允许所有分片分片重平衡。")])]),_._v(" "),e("li",[e("p",[e("code",[_._v("primaries")]),_._v(" - 允许主分片分片重平衡。")])]),_._v(" "),e("li",[e("p",[e("code",[_._v("replicas")]),_._v(" - 允许副本分片分片重平衡。")])]),_._v(" "),e("li",[e("p",[e("code",[_._v("none")]),_._v(" - 不允许分片重平衡。")])]),_._v(" "),e("li",[e("p",[e("code",[_._v("index.gc_deletes")])])])]),_._v(" "),e("p",[e("a",{attrs:{href:"/rest_apis/document_apis/delete#%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6"}},[_._v("已删除文档版本号")]),_._v("仍可用于"),e("a",{attrs:{href:"/rest_apis/index_apis#%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6"}},[_._v("进一步版本化操作")]),_._v("的时长。默认为 "),e("code",[_._v("60s")]),_._v("。")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("index.default_pipeline")])])]),_._v(" "),e("p",[_._v("默认的索引"),e("a",{attrs:{href:"/ingest/ingest"}},[_._v("输入节点")]),_._v("管道。如果设置了默认管道，管道又不存在，索引请求将失败。可以使用 "),e("code",[_._v("pipeline")]),_._v(" 参数覆盖默认值。特定的管道名称 "),e("code",[_._v("_none")]),_._v(" 表明不运行输入管道。")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("index.final_pipeline")])])]),_._v(" "),e("p",[_._v("最终的索引"),e("a",{attrs:{href:"/ingest/ingest"}},[_._v("输入节点")]),_._v("管道。如果设置了默认管道，管道又不存在，索引请求将失败。最终管道始终在请求管道（如果指定）和默认管道（如果存在）之后运行。特定的管道名称 "),e("code",[_._v("_none")]),_._v(" 表明不运行输入管道。")]),_._v(" "),e("h2",{attrs:{id:"其他索引模块中的设置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#其他索引模块中的设置"}},[_._v("#")]),_._v(" 其他索引模块中的设置")]),_._v(" "),e("p",[_._v("索引模块中的其他设置：")]),_._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"/text_analysis"}},[_._v("分析")])])]),_._v(" "),e("p",[_._v("设置默认的分析器、分词器、标记过滤器和字符过滤器。")]),_._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"/index_modules/index_shard/index_shard"}},[_._v("索引分片分配")])])]),_._v(" "),e("p",[_._v("控制分片分配给节点的位置、时间和方式。")]),_._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"/index_modules/mapper"}},[_._v("映射")])])]),_._v(" "),e("p",[_._v("允许或禁用索引的动态映射。")]),_._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"/index_modules/merge"}},[_._v("合并")])])]),_._v(" "),e("p",[_._v("控制如何通过后台合并进程合并分片。")]),_._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"/index_modules/similarity"}},[_._v("相似性")])])]),_._v(" "),e("p",[_._v("配置自定义相似性设置以自定义搜索结果的评分方式。")]),_._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"/index_modules/slow_log"}},[_._v("慢日志")])])]),_._v(" "),e("p",[_._v("控制如何记录慢查询和取出请求（fetch query）日志。")]),_._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"/index_modules/store/store"}},[_._v("存储")])])]),_._v(" "),e("p",[_._v("配置用于访问分片数据的文件系统类型。")]),_._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"/index_modules/translog"}},[_._v("事务日志")])])]),_._v(" "),e("p",[_._v("控制事务日志和后台刷新操作。")]),_._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"/index_modules/history_retention"}},[_._v("历史保留")])])]),_._v(" "),e("p",[_._v("控制索引操作历史的保留。")]),_._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"/index_modules/indexing_pressure"}},[_._v("索引压力")])])]),_._v(" "),e("p",[_._v("配置索引背压限制。")]),_._v(" "),e("h2",{attrs:{id:"x-pack-索引设置-x-pack"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#x-pack-索引设置-x-pack"}},[_._v("#")]),_._v(" X-Pack 索引设置 ["),e("code",[_._v("X-Pack")]),_._v("]")]),_._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"/set_up_elasticsearch/configuring_elasticsearch/index_lifecycle"}},[_._v("索引生命周期管理")])])]),_._v(" "),e("p",[_._v("指定的索引的生命周期策略和翻转别名。")]),_._v(" "),e("blockquote",[e("p",[e("a",{attrs:{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/index-modules.html",target:"_blank",rel:"noopener noreferrer"}},[_._v("原文链接"),e("OutboundLink")],1)])])],1)}),[],!1,null,null,null);e.default=a.exports}}]);