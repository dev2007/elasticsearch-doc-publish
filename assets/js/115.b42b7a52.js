(window.webpackJsonp=window.webpackJsonp||[]).push([[115],{393:function(e,a,s){"use strict";s.r(a);var t=s(13),r=Object(t.a)({},(function(){var e=this,a=e._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"断路器设置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#断路器设置"}},[e._v("#")]),e._v(" 断路器设置")]),e._v(" "),a("p",[e._v("Elasticsearch 包含多个断路器，用于防止操作导致 OutOfMemoryError。每个断路器都指定了它可以使用多少内存的限制。此外，还有一个父级断路器，它指定可以跨所有断路器使用的内存总量。")]),e._v(" "),a("p",[e._v("除非另有说明，否则可以使用 "),a("a",{attrs:{href:"/rest_apis/cluster_apis/cluster_update_setting"}},[e._v("集群更新设置 API")]),e._v(" 在活动集群上动态更新这些设置。")]),e._v(" "),a("p",[e._v("有关断路器错误的信息，参阅"),a("a",{attrs:{href:"/troubleshooting/circuit-breaker_errors"}},[e._v("断路器错误")]),e._v("。")]),e._v(" "),a("h2",{attrs:{id:"父断路器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#父断路器"}},[e._v("#")]),e._v(" 父断路器")]),e._v(" "),a("p",[e._v("父级断路器可以配置以下设置：")]),e._v(" "),a("ul",[a("li",[a("p",[a("code",[e._v("indices.breaker.total.use_real_memory")])]),e._v(" "),a("p",[e._v("（"),a("a",{attrs:{href:"/set_up_elasticsearch/configuring_elasticsearch"}},[e._v("静态")]),e._v("）确定父断路器是应考虑实际内存使用（"),a("code",[e._v("true")]),e._v("）还是仅考虑子断路器保留的内存量（"),a("code",[e._v("false")]),e._v("）。默认为 "),a("code",[e._v("true")]),e._v("。")])]),e._v(" "),a("li",[a("p",[a("code",[e._v("indices.breaker.total.limit")]),e._v(" "),a("a",{attrs:{href:"https://www.elastic.co/cloud/elasticsearch-service/signup?baymax=docs-body&elektra=docs",target:"_blank",rel:"noopener noreferrer"}},[a("img",{attrs:{src:"https://doc-icons.s3.us-east-2.amazonaws.com/logo_cloud.svg",alt:"Elasticsearch 服务支持"}}),a("OutboundLink")],1)]),e._v(" "),a("p",[e._v("（"),a("a",{attrs:{href:"/set_up_elasticsearch/configuring_elasticsearch#%E9%9B%86%E7%BE%A4%E5%92%8C%E8%8A%82%E7%82%B9%E8%AE%BE%E7%BD%AE%E7%B1%BB%E5%9E%8B"}},[e._v("动态")]),e._v("）整体母断路器的启动限制。如果 "),a("code",[e._v("indices.breaker.total.use_real_memory")]),e._v(" 为 "),a("code",[e._v("false")]),e._v("，则默认 JVM 堆为 70%。。如果 "),a("code",[e._v("indices.breaker.total.use_real_memory")]),e._v(" 为 "),a("code",[e._v("true")]),e._v("，默认 JVM 堆为 95%。")])])]),e._v(" "),a("h2",{attrs:{id:"字段数据断路器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#字段数据断路器"}},[e._v("#")]),e._v(" 字段数据断路器")]),e._v(" "),a("p",[e._v("字段数据断路器估计将字段加载到字段数据缓存所需的堆内存。如果加载字段会导致缓存超过预定义的内存限制，断路器将停止操作并返回错误。")]),e._v(" "),a("ul",[a("li",[a("p",[a("code",[e._v("indices.breaker.fielddata.limit")]),e._v(" "),a("a",{attrs:{href:"https://www.elastic.co/cloud/elasticsearch-service/signup?baymax=docs-body&elektra=docs",target:"_blank",rel:"noopener noreferrer"}},[a("img",{attrs:{src:"https://doc-icons.s3.us-east-2.amazonaws.com/logo_cloud.svg",alt:"Elasticsearch 服务支持"}}),a("OutboundLink")],1)]),e._v(" "),a("p",[e._v("（"),a("a",{attrs:{href:"/set_up_elasticsearch/configuring_elasticsearch#%E9%9B%86%E7%BE%A4%E5%92%8C%E8%8A%82%E7%82%B9%E8%AE%BE%E7%BD%AE%E7%B1%BB%E5%9E%8B"}},[e._v("动态")]),e._v("）现场数据断路器的限制。默认为 JVM 堆的 40%。")])]),e._v(" "),a("li",[a("p",[a("code",[e._v("indices.breaker.fielddata.overhead")]),e._v(" "),a("a",{attrs:{href:"https://www.elastic.co/cloud/elasticsearch-service/signup?baymax=docs-body&elektra=docs",target:"_blank",rel:"noopener noreferrer"}},[a("img",{attrs:{src:"https://doc-icons.s3.us-east-2.amazonaws.com/logo_cloud.svg",alt:"Elasticsearch 服务支持"}}),a("OutboundLink")],1)]),e._v(" "),a("p",[e._v("（"),a("a",{attrs:{href:"/set_up_elasticsearch/configuring_elasticsearch#%E9%9B%86%E7%BE%A4%E5%92%8C%E8%8A%82%E7%82%B9%E8%AE%BE%E7%BD%AE%E7%B1%BB%E5%9E%8B"}},[e._v("动态")]),e._v("）将所有现场数据估计值相乘以确定最终估计值的常数。默认为 "),a("code",[e._v("1.03")]),e._v("。")])])]),e._v(" "),a("h2",{attrs:{id:"请求断路器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#请求断路器"}},[e._v("#")]),e._v(" 请求断路器")]),e._v(" "),a("p",[e._v("请求断路器允许 Elasticsearch 防止每个请求的数据结构（例如，请求期间用于计算聚合的内存）超过一定的内存量。")]),e._v(" "),a("ul",[a("li",[a("p",[a("code",[e._v("indices.breaker.request.limit")]),e._v(" "),a("a",{attrs:{href:"https://www.elastic.co/cloud/elasticsearch-service/signup?baymax=docs-body&elektra=docs",target:"_blank",rel:"noopener noreferrer"}},[a("img",{attrs:{src:"https://doc-icons.s3.us-east-2.amazonaws.com/logo_cloud.svg",alt:"Elasticsearch 服务支持"}}),a("OutboundLink")],1)]),e._v(" "),a("p",[e._v("（"),a("a",{attrs:{href:"/set_up_elasticsearch/configuring_elasticsearch#%E9%9B%86%E7%BE%A4%E5%92%8C%E8%8A%82%E7%82%B9%E8%AE%BE%E7%BD%AE%E7%B1%BB%E5%9E%8B"}},[e._v("动态")]),e._v("）请求断路器的限制，默认为 JVM 堆的 60%。")])]),e._v(" "),a("li",[a("p",[a("code",[e._v("indices.breaker.request.overhead")]),e._v(" "),a("a",{attrs:{href:"https://www.elastic.co/cloud/elasticsearch-service/signup?baymax=docs-body&elektra=docs",target:"_blank",rel:"noopener noreferrer"}},[a("img",{attrs:{src:"https://doc-icons.s3.us-east-2.amazonaws.com/logo_cloud.svg",alt:"Elasticsearch 服务支持"}}),a("OutboundLink")],1)]),e._v(" "),a("p",[e._v("（"),a("a",{attrs:{href:"/set_up_elasticsearch/configuring_elasticsearch#%E9%9B%86%E7%BE%A4%E5%92%8C%E8%8A%82%E7%82%B9%E8%AE%BE%E7%BD%AE%E7%B1%BB%E5%9E%8B"}},[e._v("动态")]),e._v("）一个常数，所有请求估计都与之相乘以确定最终估计。默认为 "),a("code",[e._v("1")]),e._v("。")])])]),e._v(" "),a("h2",{attrs:{id:"动态请求断路器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#动态请求断路器"}},[e._v("#")]),e._v(" 动态请求断路器")]),e._v(" "),a("p",[e._v("动态请求断路器允许 Elasticsearch 限制传输或 HTTP 级别上所有当前活动传入请求的内存使用，使其不超过节点上的特定内存量。内存使用情况基于请求本身的内容长度。这个断路器还考虑到，不仅需要内存来表示原始请求，而且还需要内存作为一个结构化对象，由默认开销反映出来。")]),e._v(" "),a("ul",[a("li",[a("p",[a("code",[e._v("network.breaker.inflight_requests.limit")])]),e._v(" "),a("p",[e._v("（"),a("a",{attrs:{href:"/set_up_elasticsearch/configuring_elasticsearch#%E9%9B%86%E7%BE%A4%E5%92%8C%E8%8A%82%E7%82%B9%E8%AE%BE%E7%BD%AE%E7%B1%BB%E5%9E%8B"}},[e._v("动态")]),e._v("）运行中请求断路器的限制，默认为 JVM 堆的 100%。这意味着它受到为主断路器配置的限制的约束。")])]),e._v(" "),a("li",[a("p",[a("code",[e._v("network.breaker.inflight_requests.overhead")])]),e._v(" "),a("p",[e._v("（"),a("a",{attrs:{href:"/set_up_elasticsearch/configuring_elasticsearch#%E9%9B%86%E7%BE%A4%E5%92%8C%E8%8A%82%E7%82%B9%E8%AE%BE%E7%BD%AE%E7%B1%BB%E5%9E%8B"}},[e._v("动态")]),e._v("）一个常数，所有动态请求估值都乘以该常数以确定最终估值。默认为 "),a("code",[e._v("2")]),e._v("。")])])]),e._v(" "),a("h2",{attrs:{id:"记账请求断路器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#记账请求断路器"}},[e._v("#")]),e._v(" 记账请求断路器")]),e._v(" "),a("p",[e._v("记帐断路器允许 Elasticsearch 限制内存中保存的、请求完成时未释放的内容的内存使用。这包括 Lucene 段内存之类的东西。")]),e._v(" "),a("ul",[a("li",[a("p",[a("code",[e._v("indices.breaker.accounting.limit")])]),e._v(" "),a("p",[e._v("（"),a("a",{attrs:{href:"/set_up_elasticsearch/configuring_elasticsearch#%E9%9B%86%E7%BE%A4%E5%92%8C%E8%8A%82%E7%82%B9%E8%AE%BE%E7%BD%AE%E7%B1%BB%E5%9E%8B"}},[e._v("动态")]),e._v("）记帐断路器的限制，默认为 JVM 堆的 100%。这意味着它受到为主断路器配置的限制的约束。")])]),e._v(" "),a("li",[a("p",[a("code",[e._v("indices.breaker.accounting.overhead")])]),e._v(" "),a("p",[e._v("（"),a("a",{attrs:{href:"/set_up_elasticsearch/configuring_elasticsearch#%E9%9B%86%E7%BE%A4%E5%92%8C%E8%8A%82%E7%82%B9%E8%AE%BE%E7%BD%AE%E7%B1%BB%E5%9E%8B"}},[e._v("动态")]),e._v("）将所有记账估值相乘以确定最终估值的常数。默认为 1。")])])]),e._v(" "),a("h2",{attrs:{id:"脚本编译断路器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#脚本编译断路器"}},[e._v("#")]),e._v(" 脚本编译断路器")]),e._v(" "),a("p",[e._v("与以前基于内存的断路器略有不同，脚本编译断路器限制了一段时间内内联脚本编译的数量。")]),e._v(" "),a("ul",[a("li",[a("p",[a("code",[e._v("script.max_compilations_rate")])]),e._v(" "),a("p",[e._v("（"),a("a",{attrs:{href:"/set_up_elasticsearch/configuring_elasticsearch#%E9%9B%86%E7%BE%A4%E5%92%8C%E8%8A%82%E7%82%B9%E8%AE%BE%E7%BD%AE%E7%B1%BB%E5%9E%8B"}},[e._v("动态")]),e._v("）限制在特定间隔内允许编译的唯一动态脚本的数量。默认为 "),a("code",[e._v("150/5m")]),e._v("，即每 5 分钟 150 次。")])])]),e._v(" "),a("p",[e._v("如果集群定期达到给定的 "),a("code",[e._v("max_compilation_rate")]),e._v("，则脚本缓存可能大小不足，请使用"),a("a",{attrs:{href:"/rest_apis/cluster_apis/nodes_stats"}},[e._v("节点统计")]),e._v("检查最近缓存收回的数量、 "),a("code",[e._v("script.cache_evictions_history")]),e._v(" 和编译 "),a("code",[e._v("script.compilations_hiology")]),e._v("。如果最近有大量缓存收回或编译，脚本缓存可能大小不足，请考虑通过设置 "),a("code",[e._v("script.cache.max_size")]),e._v(" 将脚本缓存的大小加倍。")]),e._v(" "),a("p",[e._v("有关详细信息，参阅"),a("RouterLink",{attrs:{to:"/scripting/how_to_write_scripts/"}},[e._v("脚本")]),e._v("文档的“首选参数”部分。")],1),e._v(" "),a("h2",{attrs:{id:"正则断路器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#正则断路器"}},[e._v("#")]),e._v(" 正则断路器")]),e._v(" "),a("p",[e._v("编写不好的正则表达式会降低集群的稳定性和性能。正则断路器限制了 "),a("a",{attrs:{href:"/painless_language_specification/regexes"}},[e._v("Painless 脚本中正则")]),e._v("的使用和复杂性。")]),e._v(" "),a("ul",[a("li",[a("p",[a("code",[e._v("script.painless.regex.enabled")])]),e._v(" "),a("p",[e._v("（"),a("a",{attrs:{href:"/set_up_elasticsearch/configuring_elasticsearch"}},[e._v("静态")]),e._v("）在 Painless 脚本中启用正则。允许以下值：")]),e._v(" "),a("ul",[a("li",[a("p",[a("code",[e._v("limited")]),e._v(" ("),a("strong",[e._v("默认")]),e._v(")")]),e._v(" "),a("p",[e._v("启用正则，但使用 "),a("code",[e._v("script.painles.regex.limit-factor")]),e._v(" 集群设置限制复杂度。")])]),e._v(" "),a("li",[a("p",[a("code",[e._v("true")])]),e._v(" "),a("p",[e._v("启用正则并不限制复杂度。禁用正则断路器。")])]),e._v(" "),a("li",[a("p",[a("code",[e._v("false")])]),e._v(" "),a("p",[e._v("禁用正则。任何包含正则表达式的 Painless 脚本都会返回一个错误。")])])])]),e._v(" "),a("li",[a("p",[a("code",[e._v("script.painless.regex.limit-factor")])]),e._v(" "),a("p",[e._v("（"),a("a",{attrs:{href:"/set_up_elasticsearch/configuring_elasticsearch"}},[e._v("静态")]),e._v("）限制 Painless 脚本中正则表达式可以考虑的字符数。Elasticsearch 通过将设置值乘以脚本输入的字符长度来计算此限制。")]),e._v(" "),a("p",[e._v("例如，输入 "),a("code",[e._v("foobarbaz")]),e._v(" 的字符长度为 "),a("code",[e._v("9")]),e._v("。如果是 "),a("code",[e._v("script.painless.regex.limit-factor")]),e._v(" 为 "),a("code",[e._v("6")]),e._v("，"),a("code",[e._v("foobarbaz")]),e._v(" 上的正则表达式最多可以考虑 54（9 * 6）个字符。如果表达式超过此限制，则会触发正则断路器并返回错误。")]),e._v(" "),a("p",[e._v("Elasticsearch 仅在 "),a("code",[e._v("script.painless.regex.enabled")]),e._v(" 为 "),a("code",[e._v("limited")]),e._v(" 时应用此限制。")])])]),e._v(" "),a("blockquote",[a("p",[a("a",{attrs:{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/circuit-breaker.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("原文链接"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=r.exports}}]);