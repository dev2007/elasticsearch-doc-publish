(window.webpackJsonp=window.webpackJsonp||[]).push([[134],{412:function(s,a,e){"use strict";e.r(a);var t=e(13),r=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"使用-docker-安装-elasticsearch"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-docker-安装-elasticsearch"}},[s._v("#")]),s._v(" 使用 Docker 安装 Elasticsearch")]),s._v(" "),a("p",[s._v("Elasticsearch 也提供 Docker 镜像。镜像使用 "),a("a",{attrs:{href:"https://hub.docker.com/_/centos/",target:"_blank",rel:"noopener noreferrer"}},[s._v("centos:8"),a("OutboundLink")],1),s._v(" 作为基础镜像。")]),s._v(" "),a("p",[s._v("所有已发布的 Docker 镜像列表和版本都在 "),a("a",{attrs:{href:"www.docker.elastic.co"}},[s._v("www.docker.elastic.co")]),s._v(" 上。源文件在 "),a("a",{attrs:{href:"https://github.com/elastic/elasticsearch/blob/7.11/distribution/docker",target:"_blank",rel:"noopener noreferrer"}},[s._v("github"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("p",[s._v("软件包包含免费和订阅的特性。"),a("a",{attrs:{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/license-settings.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("开始 30 天的试用"),a("OutboundLink")],1),s._v("，尝试所有功能。")]),s._v(" "),a("h2",{attrs:{id:"拉取镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#拉取镜像"}},[s._v("#")]),s._v(" 拉取镜像")]),s._v(" "),a("p",[s._v("Docker 上获取 Elasticsearch，简单到只要向 Elastic Docker 仓库发出 docker pull 命令一样。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull docker.elastic.co/elasticsearch/elasticsearch:7.11.2\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"使用-docker-启动单节点集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-docker-启动单节点集群"}},[s._v("#")]),s._v(" 使用 Docker 启动单节点集群")]),s._v(" "),a("p",[s._v("要启动单节点 Elasticsearch 集群进行开发或测试，请指定"),a("a",{attrs:{href:"/set_up_elasticsearch/bootstrap#%E5%8D%95%E8%8A%82%E7%82%B9%E5%8F%91%E7%8E%B0"}},[s._v("单节点发现")]),s._v("以绕过"),a("a",{attrs:{href:"/set_up_elasticsearch/bootstrap"}},[s._v("启动检查")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),s._v(":9200 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9300")]),s._v(":9300 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"discovery.type=single-node"')]),s._v(" docker.elastic.co/elasticsearch/elasticsearch:7.11.2\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"使用-docker-compose-启动多节点集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-docker-compose-启动多节点集群"}},[s._v("#")]),s._v(" 使用 Docker Compose 启动多节点集群")]),s._v(" "),a("p",[s._v("为了在 Docker 中启动和运行一个三节点 Elasticsearch 集群，你可以使用 Docker Compose：")]),s._v(" "),a("ul",[a("li",[s._v("创建一个 "),a("code",[s._v("docker-compose.yml")]),s._v(" 文件：")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2.2'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("es01")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" docker.elastic.co/elasticsearch/elasticsearch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("7.11.2\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" es01\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" node.name=es01\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" cluster.name=es"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cluster\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" discovery.seed_hosts=es02"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("es03\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" cluster.initial_master_nodes=es01"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("es02"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("es03\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" bootstrap.memory_lock=true\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ES_JAVA_OPTS=-Xms512m -Xmx512m"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ulimits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("memlock")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("soft")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("-1")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hard")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("-1")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" data01"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/usr/share/elasticsearch/data\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 9200"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" elastic\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("es02")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" docker.elastic.co/elasticsearch/elasticsearch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("7.11.2\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" es02\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" node.name=es02\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" cluster.name=es"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cluster\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" discovery.seed_hosts=es01"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("es03\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" cluster.initial_master_nodes=es01"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("es02"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("es03\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" bootstrap.memory_lock=true\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ES_JAVA_OPTS=-Xms512m -Xmx512m"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ulimits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("memlock")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("soft")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("-1")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hard")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("-1")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" data02"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/usr/share/elasticsearch/data\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" elastic\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("es03")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" docker.elastic.co/elasticsearch/elasticsearch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("7.11.2\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" es03\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" node.name=es03\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" cluster.name=es"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cluster\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" discovery.seed_hosts=es01"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("es02\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" cluster.initial_master_nodes=es01"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("es02"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("es03\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" bootstrap.memory_lock=true\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ES_JAVA_OPTS=-Xms512m -Xmx512m"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ulimits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("memlock")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("soft")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("-1")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hard")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("-1")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" data03"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/usr/share/elasticsearch/data\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" elastic\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("data01")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("driver")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" local\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("data02")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("driver")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" local\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("data03")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("driver")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" local\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("elastic")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("driver")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" bridge\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br")])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),a("p",[s._v("例子中的 "),a("code",[s._v("docker-compose.yml")]),s._v(" 使用环境变量 "),a("code",[s._v("ES_JAVA_OPTS")]),s._v(" 手工设置堆大小为 512 MB。我们不推荐在生产环境使用 "),a("code",[s._v("ES_JAVA_OPTS")]),s._v("。参看"),a("a",{attrs:{href:"/set_up_elasticsearch/installing_elasticsearch/docker#%E6%89%8B%E5%B7%A5%E8%AE%BE%E7%BD%AE%E5%A0%86%E5%A4%A7%E5%B0%8F"}},[s._v("手工设置堆大小")]),s._v("。")])]),s._v(" "),a("p",[s._v("这个示例 Docker Compose 文件，提供了一个三节点 Elasticsearch 集群。节点 "),a("code",[s._v("es01")]),s._v(" 监听 "),a("code",[s._v("localhost:9200")]),s._v("，"),a("code",[s._v("es02")]),s._v(" 和 "),a("code",[s._v("es03")]),s._v(" 通过 Docker 网络与 "),a("code",[s._v("es01")]),s._v(" 通信。")]),s._v(" "),a("p",[s._v("请注意此配置在所有网络接口上暴露端口 9200，并且考虑到 Docker 怎么在 Linux 上操作 "),a("code",[s._v("iptables")]),s._v("，这意味着你的 Elasticsearch 集群可以公开访问，可能会忽略任何防火墙设置。如果你不想暴露端口 9200，转而使用反向代理，在 docker-compose.yml 文件中用 "),a("code",[s._v("127.0.0.1:9200:9200")]),s._v(" 替代 "),a("code",[s._v("9200:9200")]),s._v("。Elasticsearch 将只能从主机自身访问。")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://docs.docker.com/storage/volumes",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker 命名卷"),a("OutboundLink")],1),s._v(" "),a("code",[s._v("data01")]),s._v("、"),a("code",[s._v("data02")]),s._v(" 和 "),a("code",[s._v("data03")]),s._v(" 存储节点数据目录，以便重启时数据持续存在。如果他们不存在，docker-compose 将会在你创建集群时创建他们。")]),s._v(" "),a("ol",[a("li",[s._v("确保 Docker Engine 分配了至少 4 GiB 内存。在 Docker 桌面中，你可以在首选项（macOS）或设置（Windows）的高级选项卡中配置资源使用。")])]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),a("p",[s._v("在 Linux 上，Docker Compose 未与 Docker 一起预装。在 docs.docker.com 查看安装指南："),a("a",{attrs:{href:"https://docs.docker.com/compose/install",target:"_blank",rel:"noopener noreferrer"}},[s._v("在 Linux 安装 Compose"),a("OutboundLink")],1)])]),s._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[s._v("运行 docker-compose 以启动集群：")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" up\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("提交请求 "),a("code",[s._v("_cat/nodes")]),s._v(" 查看节点是否启动运行")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-X")]),s._v(" GET "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:9200/_cat/nodes?v=true&pretty"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("日志消息进入控制台，由配置的 Docker 日志驱动处理。默认情况下，你可以使用 "),a("code",[s._v("docker logs")]),s._v(" 访问日志。如果你更想 Elasticsearch 容器把日志写入磁盘，设置环境变量 "),a("code",[s._v("ES_LOG_STYLE")]),s._v(" 为 "),a("code",[s._v("file")]),s._v("。这将导致 Elasticsearch 使用与其他 Elasticsearch 分发格式相同的配置。")]),s._v(" "),a("p",[s._v("要停止集群，运行 "),a("code",[s._v("docker-compose down")]),s._v("。当你使用 "),a("code",[s._v("docker-compose up")]),s._v(" 重启集群，Docker 卷中的数据将被保存和加载。为了在停止集群时删除数据卷，指定 "),a("code",[s._v("-v")]),s._v(" 选项： "),a("code",[s._v("docker-compose down -v")]),s._v("。")]),s._v(" "),a("h3",{attrs:{id:"启动开启-tls-的多节点集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动开启-tls-的多节点集群"}},[s._v("#")]),s._v(" 启动开启 TLS 的多节点集群")]),s._v(" "),a("p",[s._v("参阅 "),a("a",{attrs:{href:"/secure/encrypt/docker"}},[s._v("在Elasticsearch Docker 容器的加密通信")]),s._v("和"),a("a",{attrs:{href:"https://www.elastic.co/guide/en/elastic-stack-get-started/7.11/get-started-docker.html#get-started-docker-tls",target:"_blank",rel:"noopener noreferrer"}},[s._v("在 Docker 中开启 TLS 运行 Elastic 栈"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("h2",{attrs:{id:"在生产环境使用-docker-镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在生产环境使用-docker-镜像"}},[s._v("#")]),s._v(" 在生产环境使用 Docker 镜像")]),s._v(" "),a("p",[s._v("以下要求和建议适用于生产环境中在 Docker 中运行 Elasticsearch。")]),s._v(" "),a("h3",{attrs:{id:"设置-vm-max-map-count-至少为-262144"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置-vm-max-map-count-至少为-262144"}},[s._v("#")]),s._v(" 设置 "),a("code",[s._v("vm.max_map_count")]),s._v(" 至少为 "),a("code",[s._v("262144")])]),s._v(" "),a("p",[s._v("在生产环境使用，"),a("code",[s._v("vm.max_map_count")]),s._v(" 内核设置必须至少为 "),a("code",[s._v("262144")]),s._v("。")]),s._v(" "),a("p",[s._v("如何设置 "),a("code",[s._v("vm.max_map_count")]),s._v(" 基于你的平台：")]),s._v(" "),a("ul",[a("li",[s._v("Linux")])]),s._v(" "),a("p",[a("code",[s._v("vm.max_map_count")]),s._v(" 应该永久设置在 "),a("code",[s._v("/etc/sysctl.conf")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" vm.max_map_count /etc/sysctl.conf\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("vm.max_map_count")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("262144")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("在运行的系统中应用此配置，执行：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sysctl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("vm.max_map_count")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("262144")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("带 "),a("a",{attrs:{href:"https://docs.docker.com/docker-for-mac",target:"_blank",rel:"noopener noreferrer"}},[s._v("Mac 版 Docker"),a("OutboundLink")],1),s._v(" 的 macOS")])]),s._v(" "),a("p",[a("code",[s._v("vm.max_map_count")]),s._v(" 设置必须在 xhyve 虚机中设置：")]),s._v(" "),a("p",[s._v("a. 从命令行运行：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("screen")]),s._v(" ~/Library/Containers/com.docker.docker/Data/vms/0/tty\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v('b. 按回车，使用 "sysctl" 配置 '),a("code",[s._v("vm.max_map_count")]),s._v(" ：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sysctl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("vm.max_map_count")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("262144")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("c. 退出 "),a("code",[s._v("screen")]),s._v(" 会话，按 "),a("code",[s._v("Ctrl a d")])]),s._v(" "),a("ul",[a("li",[s._v("带 "),a("a",{attrs:{href:"https://www.docker.com/products/docker-desktop",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker 桌面版"),a("OutboundLink")],1),s._v("的 Windows 和 macOS")])]),s._v(" "),a("p",[a("code",[s._v("vm.max_map_count")]),s._v(" 必须通过 docker-machine 设置。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("docker-machine "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sysctl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("vm.max_map_count")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("262144")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ul",[a("li",[s._v("带 "),a("a",{attrs:{href:"https://docs.docker.com/docker-for-windows/wsl/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker WSL 2 后端桌面版"),a("OutboundLink")],1),s._v("的 Windows")])]),s._v(" "),a("p",[a("code",[s._v("vm.max_map_count")]),s._v(" 必须在 "),a("code",[s._v("docker-desktop")]),s._v(" 容器中设置。")]),s._v(" "),a("div",{staticClass:"language-powershell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[s._v("wsl "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("d docker-desktop\nsysctl "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("w vm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("max_map_count=262144\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"配置文件必须可被用户-elasticsearch-用户读取"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置文件必须可被用户-elasticsearch-用户读取"}},[s._v("#")]),s._v(" 配置文件必须可被用户 "),a("code",[s._v("elasticsearch")]),s._v(" 用户读取")]),s._v(" "),a("p",[s._v("默认情况下，Elasticsearch 通过 uid:gid "),a("code",[s._v("1000:0")]),s._v("，以用户 "),a("code",[s._v("elasticsearch")]),s._v(" 在容器中运行。")]),s._v(" "),a("div",{staticClass:"custom-block danger"},[a("p",{staticClass:"custom-block-title"},[s._v("警告")]),s._v(" "),a("p",[s._v("一个例外是 "),a("a",{attrs:{href:"https://docs.openshift.com/container-platform/3.6/creating_images/guidelines.html#openshift-specific-guidelines",target:"_blank",rel:"noopener noreferrer"}},[s._v("OpenShift"),a("OutboundLink")],1),s._v("，它使用任意分配的用户 ID 运行容器。OpenShift 显示的持久卷的 gid 设置为 0，它可以无需调整的运行。")])]),s._v(" "),a("p",[s._v("如果你要绑定挂载本地目录或文件，它必须可被用户 "),a("code",[s._v("elasticsearch")]),s._v(" 读取。此外，此用户对 "),a("a",{attrs:{href:"/set_up_elasticsearch/important_es_config#%E8%B7%AF%E5%BE%84%E8%AE%BE%E7%BD%AE"}},[s._v("配置、数据和日志目录")]),s._v("有写权限（Elasticsearch 需要对 "),a("code",[s._v("config")]),s._v(" 目录有写权限，这样它才能生成密钥库）。一个好的策略是为本地目录 gid "),a("code",[s._v("0")]),s._v(" 分配组访问权限。")]),s._v(" "),a("p",[s._v("例如，要准备本地目录以通过绑定挂载来存储数据，按以下操作：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" esdatadir\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" g+rwx esdatadir\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chgrp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" esdatadir\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("你也可以使用自定义 UID 和 GID 来运行 Elasticsearch 容器。除非你绑定挂载每个 "),a("code",[s._v("config")]),s._v("、"),a("code",[s._v("data")]),s._v(" 和 "),a("code",[s._v("logs")]),s._v(" 目录，否则必须为 "),a("code",[s._v("docker run")]),s._v(" 传递命令行选项 "),a("code",[s._v("--group-add 0")]),s._v("。这样可以确保运行 Elasticsearch 的用户也是容器 "),a("code",[s._v("root")]),s._v(" （GID 0）组的成员。")]),s._v(" "),a("p",[s._v("最后，你还可以通过环境变量 "),a("code",[s._v("TAKE_FILE_OWNERSHIP")]),s._v(" 强制容器更改用于"),a("a",{attrs:{href:"/set_up_elasticsearch/important#%E8%B7%AF%E5%BE%84%E8%AE%BE%E7%BD%AE"}},[s._v("数据和日志目录")]),s._v("的绑定挂载的所有权。当你这样做的时候，它们将属于 uid:gid "),a("code",[s._v("1000:0")]),s._v("，它提供了 Elasticsearch 进程所需的读写访问权限。")]),s._v(" "),a("h3",{attrs:{id:"为-nofile-和-nproc-增加-ulimit"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为-nofile-和-nproc-增加-ulimit"}},[s._v("#")]),s._v(" 为 nofile 和 nproc 增加 ulimit")]),s._v(" "),a("p",[s._v("必须为 Elasticsearch 容器提供 "),a("a",{attrs:{href:"/set_up_elasticsearch/important_system_config/config"}},[s._v("nofile")]),s._v(" 和 "),a("a",{attrs:{href:"/set_up_elasticsearch/bootstrap/thread"}},[s._v("nproc")]),s._v(" 增加 ulimit。验证 Docker 的守护进程是否的 "),a("a",{attrs:{href:"https://github.com/moby/moby/tree/ea4d1243953e6b652082305a9c3cda8656edab26/contrib/init",target:"_blank",rel:"noopener noreferrer"}},[s._v("init system"),a("OutboundLink")],1),s._v(" 是否将它们设置为可接受的值。")]),s._v(" "),a("p",[s._v("为了检测 Docker 守护进程默认的 ulimit，执行：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--rm")]),s._v(" centos:8 /bin/bash "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ulimit -Hn && ulimit -Sn && ulimit -Hu && ulimit -Su'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如果需要，在守护进程中调整他们，或者在每个容器中重载他们。例如，使用 "),a("code",[s._v("docker run")]),s._v(" 时，设置：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--ulimit")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("nofile")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65535")]),s._v(":65535\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"禁用-swapping"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#禁用-swapping"}},[s._v("#")]),s._v(" 禁用 swapping")]),s._v(" "),a("p",[s._v("为了提高性能和节点稳定性，swapping 需要禁用。有关执行此操作的更多信息，请参阅 "),a("a",{attrs:{href:"/set_up_elasticsearch/important_system_config/swapping"}},[s._v("禁用 swapping")]),s._v("。")]),s._v(" "),a("p",[s._v("如果你选择 "),a("code",[s._v("bootstrap.memory_lock: true")]),s._v("，你也需要在 Docker 守护进程中定义 "),a("code",[s._v("memlock: true")]),s._v(" 限定，或者如"),a("a",{attrs:{href:"/set_up_elasticsearch/installing_elasticsearch/docker#%E4%BD%BF%E7%94%A8-Docker-Compose-%E5%90%AF%E5%8A%A8%E5%A4%9A%E8%8A%82%E7%82%B9%E9%9B%86%E7%BE%A4"}},[s._v("示例 compose 文件")]),s._v("中显示的设置。当使用 "),a("code",[s._v("docker run")]),s._v("，你可以指定：")]),s._v(" "),a("p",[a("code",[s._v('-e "bootstrap.memory_lock=true" --ulimit memlock=-1:-1')])]),s._v(" "),a("h3",{attrs:{id:"随机发布端口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#随机发布端口"}},[s._v("#")]),s._v(" 随机发布端口")]),s._v(" "),a("p",[s._v("镜像"),a("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder/#/expose",target:"_blank",rel:"noopener noreferrer"}},[s._v("暴露"),a("OutboundLink")],1),s._v(" TCP 端口 9200 和 9300。对生产环境集群，推荐通过 "),a("code",[s._v("--publish-all")]),s._v(" 随机发布端口，除非你为每个主机固定一个容器。")]),s._v(" "),a("h3",{attrs:{id:"手工设置堆大小"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#手工设置堆大小"}},[s._v("#")]),s._v(" 手工设置堆大小")]),s._v(" "),a("p",[s._v("默认情况下，Elasticsearch 基于节点的"),a("a",{attrs:{href:"/set_up_elasticsearch/configuring_elasticsearch/node#%E8%8A%82%E7%82%B9%E8%A7%92%E8%89%B2"}},[s._v("角色")]),s._v("和节点容器总可用内存，自动地设置 JVM 堆。对大多数生产环境，我们推荐默认大小设置。如果有需要，你可以通过手工设置 JVM 堆大小来重载默认设置。")]),s._v(" "),a("p",[s._v("为了在生产环境手工设置堆大小，绑定挂载包含了你期望的"),a("a",{attrs:{href:"/set_up_elasticsearch/configuring_elasticsearch/advanced#%E8%AE%BE%E7%BD%AE-JVM-%E5%A0%86%E5%A4%A7%E5%B0%8F"}},[s._v("堆大小")]),s._v("设置的 "),a("a",{attrs:{href:"/set_up_elasticsearch/configuring_elasticsearch/jvm"}},[s._v("JVM 选项")]),s._v("文件（在 "),a("code",[s._v("/usr/share/elasticsearch/configuring_elasticsearchjvm.options.d")]),s._v("中）。")]),s._v(" "),a("p",[s._v("用于测试的话，你可以通过环境变量 "),a("code",[s._v("ES_JAVA_OPTS")]),s._v(" 手工设置堆大小。例如，要用 16 GB，通过 "),a("code",[s._v("docker run")]),s._v(" 指定 "),a("code",[s._v('-e ES_JAVA_OPTS="-Xms16g -Xmx16g"')]),s._v("。"),a("code",[s._v("ES_JAVA_OPTS")]),s._v(" 重载所有其他 JVM 选项。在生产环境，我们不推荐使用 "),a("code",[s._v("ES_JAVA_OPTS")]),s._v("。上方的 "),a("code",[s._v("docker-compose.yml")]),s._v(" 可以看到设置堆大小为 512 MB。")]),s._v(" "),a("h3",{attrs:{id:"部署固定为指定的镜像版本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署固定为指定的镜像版本"}},[s._v("#")]),s._v(" 部署固定为指定的镜像版本")]),s._v(" "),a("p",[s._v("将部署固定为指定的 Elasticsearch Docker 镜像。例如 "),a("code",[s._v("docker.elastic.co/elasticsearch/elasticsearch:7.11.2")]),s._v("。")]),s._v(" "),a("h3",{attrs:{id:"始终绑定数据卷"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#始终绑定数据卷"}},[s._v("#")]),s._v(" 始终绑定数据卷")]),s._v(" "),a("p",[s._v("出于以下原因，你应该对 "),a("code",[s._v("/usr/share/elasticsearch/data")]),s._v(" 使用卷绑定：")]),s._v(" "),a("ol",[a("li",[s._v("如果容器被杀死，Elasticsearch 节点数据不会丢失")]),s._v(" "),a("li",[s._v("Elasticsearch 对 I/O 敏感，而 Docker 存储驱动不适合快速 I/O")]),s._v(" "),a("li",[s._v("允许使用高级 "),a("a",{attrs:{href:"https://docs.docker.com/engine/extend/plugins/#volume-plugins",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker 卷插件"),a("OutboundLink")],1)])]),s._v(" "),a("h3",{attrs:{id:"禁止使用-loop-lvm-模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#禁止使用-loop-lvm-模式"}},[s._v("#")]),s._v(" 禁止使用 "),a("code",[s._v("loop-lvm")]),s._v(" 模式")]),s._v(" "),a("p",[s._v("如果你正在使用 devicemapper 存储驱动，不要使用默认的 "),a("code",[s._v("loop-lvm")]),s._v(" 模式。配置 docker-engine 以使用 "),a("a",{attrs:{href:"https://docs.docker.com/engine/userguide/storagedriver/device-mapper-driver/#configure-docker-with-devicemapper",target:"_blank",rel:"noopener noreferrer"}},[s._v("direct-lvm"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("h3",{attrs:{id:"集中你的日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#集中你的日志"}},[s._v("#")]),s._v(" 集中你的日志")]),s._v(" "),a("p",[s._v("考虑使用不同的"),a("a",{attrs:{href:"https://docs.docker.com/engine/admin/logging/overview/",target:"_blank",rel:"noopener noreferrer"}},[s._v("日志驱动"),a("OutboundLink")],1),s._v("来集中日志。还要注意，默认的 json-file 日志驱动不适合生产环境。")]),s._v(" "),a("h2",{attrs:{id:"使用-docker-配置-elasticsearch"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-docker-配置-elasticsearch"}},[s._v("#")]),s._v(" 使用 Docker 配置 Elasticsearch")]),s._v(" "),a("p",[s._v("当你在 Docker 中运行时， "),a("a",{attrs:{href:"/set_up_elasticsearch/config#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BD%8D%E7%BD%AE"}},[s._v("Elasticsearch 配置文件")]),s._v("从 "),a("code",[s._v("/usr/share/elasticsearch/configuring_elasticsearch")]),s._v(" 加载。为了使用自定义配置文件，你要"),a("a",{attrs:{href:"/set_up_elasticsearch/installing_elasticsearch/docker#%E6%8C%82%E8%BD%BD-Elasticsearch-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"}},[s._v("绑定挂载文件")]),s._v("到镜像中的配置文件上。")]),s._v(" "),a("p",[s._v("你可以通过环境变量设置独立的 Elasticsearch 配置参数。"),a("a",{attrs:{href:"/set_up_elasticsearch/installing_elasticsearch/docker#%E4%BD%BF%E7%94%A8-Docker-Compose-%E5%90%AF%E5%8A%A8%E5%A4%9A%E8%8A%82%E7%82%B9%E9%9B%86%E7%BE%A4"}},[s._v("示例 compose 文件")]),s._v("和"),a("a",{attrs:{href:"/set_up_elasticsearch/installing_elasticsearch/docker#%E4%BD%BF%E7%94%A8-Docker-%E5%90%AF%E5%8A%A8%E5%8D%95%E8%8A%82%E7%82%B9%E9%9B%86%E7%BE%A4"}},[s._v("单节点示例")]),s._v("就用的这种方法。")]),s._v(" "),a("p",[s._v("要使用文件内容设置环境变量，给环境变量名字加上后缀 "),a("code",[s._v("_FILE")]),s._v("。这对于秘密传输配置（如密码）给 Elasticsearch，而不是直接指定它们非常有用。")]),s._v(" "),a("p",[s._v("例如，为了从文件设置 Elasticsearch 的启动密码，你可以绑定挂载这个文件，然后在挂载路径中设置环境变量"),a("code",[s._v("ELASTIC_PASSWORD_FILE")]),s._v("。如果你挂载的密码文件为 "),a("code",[s._v("/run/secrets/bootstrapPassword.txt")]),s._v(",如下指定：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ELASTIC_PASSWORD_FILE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/run/secrets/bootstrapPassword.txt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("你还可以通过传递 Elasticsearch 配置参数作为命令行选项，来重载默认的命令。例如：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("various parameters"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" bin/elasticsearch "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Ecluster.name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mynewclustername\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("虽然绑定挂载配置文件通常在生产环境是首选方法，你也可以创建包含你自己配置的"),a("a",{attrs:{href:"/set_up_elasticsearch/installing_elasticsearch/docker#%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89-Docker-%E9%95%9C%E5%83%8F"}},[s._v("自定义 Docker 镜像")]),s._v("。")]),s._v(" "),a("h3",{attrs:{id:"挂载-elasticsearch-配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#挂载-elasticsearch-配置文件"}},[s._v("#")]),s._v(" 挂载 Elasticsearch 配置文件")]),s._v(" "),a("p",[s._v("创建自定义配置文件，将其绑定挂载到 Docker 镜像的相应文件上。例如，使用 "),a("code",[s._v("docker run")]),s._v(" 绑定挂载 "),a("code",[s._v("custom_elasticsearch.yml")]),s._v("，如下指定：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" full_path_to/custom_elasticsearch.yml:/usr/share/elasticsearch/configuring_elasticsearch/elasticsearch.yml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"custom-block danger"},[a("p",{staticClass:"custom-block-title"},[s._v("警告")]),s._v(" "),a("p",[s._v("容器以用户 "),a("code",[s._v("elasticsearch")]),s._v("，使用 uid:gid "),a("code",[s._v("1000:0")]),s._v(" 运行 Elasticsearch。绑定挂载的主机目录和文件，必须能被此用户访问，且数据和日志目录必须能被此用户写入。")])]),s._v(" "),a("h3",{attrs:{id:"挂载-elasticsearch-密钥库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#挂载-elasticsearch-密钥库"}},[s._v("#")]),s._v(" 挂载 Elasticsearch 密钥库")]),s._v(" "),a("p",[s._v("默认情况下，Elasticsearch 会为安全设置自动生成密钥库文件。这个文件是混淆的，但没有加密。如果你想使用密码加密你的"),a("a",{attrs:{href:"/set_up_elasticsearch/configuring_elasticsearchsecure_settings"}},[s._v("安全设置")]),s._v("，你必须使用 "),a("code",[s._v("elasticsearch-keystore")]),s._v(" 程序去创建一个密码保护的密钥库，然后绑定挂载它到容器中文件 "),a("code",[s._v("/usr/share/elasticsearch/configuring_elasticsearchelasticsearch.keystore")]),s._v("。为了在启动时向 Docker 容器提供密码，将 Docker 的环境变量值 "),a("code",[s._v("KEYSTORE_PASSWORD")]),s._v(" 设置为密码值。例如，"),a("code",[s._v("docker run")]),s._v(" 命令可以有以下的选项：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" full_path_to/elasticsearch.keystore:/usr/share/elasticsearch/configuring_elasticsearch/elasticsearch.keystore\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-E")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KEYSTORE_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mypassword\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"使用自定义-docker-镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用自定义-docker-镜像"}},[s._v("#")]),s._v(" 使用自定义 Docker 镜像")]),s._v(" "),a("p",[s._v("在一些环境中，准备包含你配置的自定义镜像更有意义。实现这一点的 "),a("code",[s._v("Dockerfile")]),s._v(" 可能如下一样简单：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("FROM docker.elastic.co/elasticsearch/elasticsearch:7.11.2\nCOPY "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--chown")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("elasticsearch:elasticsearch elasticsearch.yml /usr/share/elasticsearch/configuring_elasticsearch\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("你可以这样构建和运行镜像：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--tag")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("elasticsearch-custom "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ti")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /usr/share/elasticsearch/data elasticsearch-custom\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("一些插件需要额外的安全权限。你必须通过以下方式明确接受它们：")]),s._v(" "),a("ul",[a("li",[s._v("当你运行 Docker 镜像时，附加 "),a("code",[s._v("tty")]),s._v(" 并在提供时允许权限。")]),s._v(" "),a("li",[s._v("通过向插件安装命令添加 "),a("code",[s._v("--batch")]),s._v(" 标志来检查安全权限，并且接受它们（如果合适）")])]),s._v(" "),a("p",[s._v("参阅"),a("a",{attrs:{href:"https://www.elastic.co/guide/en/elasticsearch/plugins/7.11/_other_command_line_parameters.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("插件管理"),a("OutboundLink")],1),s._v("，获取更多信息。")]),s._v(" "),a("h2",{attrs:{id:"下一步"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#下一步"}},[s._v("#")]),s._v(" 下一步")]),s._v(" "),a("p",[s._v("你现在有一个测试 Elasticsearch 环境部署好。在你使用 Elasticsearch 正式开始开发或者生产之前，你必须做一些额外的设置：")]),s._v(" "),a("ul",[a("li",[s._v("学习如何配置 "),a("a",{attrs:{href:"/set_up_elasticsearch/config"}},[s._v("Elasticsearch")]),s._v("。")]),s._v(" "),a("li",[s._v("配置"),a("a",{attrs:{href:"/set_up_elasticsearch/important_es_config"}},[s._v("重要的 Elasticsearch 设置")]),s._v("。")]),s._v(" "),a("li",[s._v("配置"),a("a",{attrs:{href:"/set_up_elasticsearch/important_system_config"}},[s._v("重要的系统设置")]),s._v("。")])]),s._v(" "),a("blockquote",[a("p",[a("a",{attrs:{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("原文链接"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=r.exports}}]);